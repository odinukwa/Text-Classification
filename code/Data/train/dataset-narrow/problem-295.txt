Troubleshooting If your ge- interfaces aren't working, then the communication between the VCP and the VFP VMs is probably the problem. When everything's good, the ge- interfaces should show up when you do a show interfaces: 

real proxy-identity settings As a second test, I've added real proxy-identity settings to match my remote and local subnets: 

In other words, my assumption is correct and leaving the stanza blank means the router uses its default settings. 

You can find full documentation here. You're on the right track, but cluster-id should be greater than 0. From the documentation: 

MQC (Modular QoS CLI) is the CLI structure that allows you to enable QoS features in Cisco routers (see the manual). It uses the following three steps to configure QoS: 

According to the documentation: "An interface or command with an empty access list applied to it permits all traffic into the network." So as soon as you add any term to the ACL, it will start blocking all other traffic. 

There is an implicit "deny" at the end of every access-list. So your current access-list actually says: 

Proxy-identity is used only for negotiating the IKE phase of the VPN, and has to mirror the proxy-identity that is set on the other site of the VPN tunnel. It has no effect on actually routing or permitting traffic through the tunnel once it has been established, that has to be done with routes and/or policies. This is easily verified if you have access to Juniper routers where you can mess around with the VPN settings. no proxy-identity settings Testing default settings without mentioning proxy-identity. 

You need to replace the switch with a managed switch that supports VLANs for this to work. The Sonicwall X0 interface is configured as a trunk, with to VLANs: a "native" VLAN for untagged frames, and V10 for frames tagged with VLAN ID 10. Frames that arrive at the Sonicwall untagged come in at interface X0, and frames that are tagged with VLAN ID 10 come in at interface X0:V10. The switch you have does not support VLANs. This means that it will send all traffic to the Sonicwall untagged. So regardless of what you configure on the IP Phone, traffic will arrive only on interface X0, and never on X0:V10. In order for this to work, you would need to configure the switchports to the Sonicwall and to the IP Phones with an untagged "native" VLAN and a tagged VLAN 10. So you need to have a managed switch that supports VLANs instead of the unmanaged switch. 

This means any UDP traffic (except from the client to port 137) is allowed, but all other traffic on that interface (including TCP and ICMP) is dropped. What you're looking for is this: 

The sample chapter on "VPNs and VPN Technology" from the Cisco Press book "Cisco Secure Virtual Private Networks" is a pretty good summary of IPSec VPNs and how all the bits and pieces fit together. You can find it here: $URL$ 

Keep in mind that you need to connect the two SRX300 devices on port ge-0/0/1 (for the control link). In the factory default configuration, this interface is already configured and part of a security zone; you need to remove all configuration relating to this interface before the chassis cluster will form. 

wait long enough for the VFP to boot properly (takes longer than the VCP). try to ping the VFP from the VCP to verify : 

Both these points can be addressed by the OEAP without using a VPN, but this will require some additional steps. 

These .jar files are probably configuration backups made with Cisco Network Assistant. These files are compressed (zipped) with a java extention, but you can extract them with WinZip or WinRAR or any other decompression software of choice. 

This has to do with how (UTP) Ethernet cabling works. In the old days, end point devices (like your PC) would use wires 1 and 2 to transmit data, and wires 3 and 6 to listen ($URL$ (*). The switch on the other side of the cable would listen on wires 1 and 2, and transmit on 3 and 6. Now if you would connect two siwtches, this would not work with a regular cable, because both switches would use the same wires in the cable to transmit. On solution for this is to use a special crossover cable, within which the cabling is crossed. Another solution is to have a specific "Uplink" port on the switch, which is wired as an end-point and uses the same wires to listen/transmit as a regular PC for instance. With modern devices this is all a moot point, since practically every device uses "Auto-MDI-X" ($URL$ to sense which wire to listen and to transmit on. This standard was introduced in 1998, so it's very rare to find use for your old crossover cables today. As for your Linksys switch: you can use the Uplink port to connect an end-point if you would use a crossover cable. However, in the internal wiring in the switch the Uplink port is the same port as port number 5 ($URL$ so you can only use one of them (either the Uplink port, or port 5, not both simultaneously). (*) This is true for 10BASE-T (10 Mbit/s) and 100BASE-TX (100 Mbit/s) Ethernet. Gigabit Ethernet uses all 8 wires in the cable. 

Your setup with a routed link between the switches should work fine, but you need to check two more points: 

You will need to reboot the switch after you commit the configuration (you'll get a warning to do this): 

Security. All traffic between access point and controller (CAPWAP tunnel) can be encrypted, but this might not be enabled by default. Also, if you want to authenticate the OEAPs properly, you might need to set up a proper PKI. Depending on the security policy at your company, this might or might not be enough. Reachability. The OEAP needs to be able to reach the controller. This can be done by forwarding UDP ports 5246 and 5247 to the controller. If the controller uses a private IPv4 address, support for NAT must be enabled on the controller. 

According to the datasheet, the EX3300 is limited to 4000 ARP entries. It looks like this is a hardware limitation; there is no way to load a different "SDM template" like in Cisco IOS, so you're stuck on this number. If you have a very dynamic network, you can try to reduce the ARP aging timer, to age-out stale ARP entries faster: 

These security policies have an implicit "deny", so all traffic not specified is dropped. When you're this far, the SRX is working as transparent firewall, but unfortunately you can no longer manage it remotely since we didn't specify any rules for that. Assuming you would want to manage the device from the "Intranet" side only, we need to allow traffic to the SRX device (host-inbound-traffic) in the intranet zone: 

Proxy-identity defaults to whatever you have set on the policy (in case of policy-based VPN). In case of route-based VPN, it defaults to: 

Normally you would be right, there is an implied "deny" at the end of every access list. You have found the exception however, because you use an empty access list: 

HQC (Hierarchical Queuing Framework) is an evolution of MQC that is introduced in IOS 12.4(20)T, that adds the following functionality (from the white paper): 

You are correct, you're ISP is using an additional box to NAT your connection. They are doing this to conserve IPv4 addresses, and it's called Carrier Grade NAT (CGN). This makes it impossible for you to use port-forwards unless your ISP also configures them on their CGN-box (which they will probably refuse to do). CGN should only be used as a transition mechanism in combination with IPv6. With IPv6 you can have as many public IPs in your network as you need. If your provider is currently not giving you IPv6 addresses, then you should definitely complain about being behind CGN. As an aside: the IP range that you ISP (Syscon?) is using to NAT your connection (172.171.0.0/16) is indeed a public IP range, but one that does not belong to them and is in use by AOL. If you're having trouble gaming or making Skype calls to the US, that is probably why. 

In this case you will have to run the SRX in "Transparent Mode", in stead of the default "Routed Mode". This has a couple of caveats and limitations, so be sure to check the documentation first. You have to do a couple of things to make this work. First of all, get rid of all the "VLAN" configuration, and start using a bridge domain: 

Security. Encrypt traffic over the internet. This is always a good idea. Reachability. If you're still using IPv4 (like everybody else), you're probably using private (RFC1918) addresses at one or both locations. The VPN will tunnel traffic across the internet so that hosts using private addresses can reach eachother without using NAT. 

Short answer: no. Cisco IP Access Lists can only "permit" or "deny" (drop) packets. Edit: I stand corrected. Configuring IP Unreachables on the interface results in an ICMP-unreachable message when the packet is dropped. 

If I understand your topology correctly, you are using the SRX as a layer-2 device between your ISP router and the hosts in the branch (in place of the managed switch in the drawing). 

For some reason the Juniper documentation ($URL$ doesn't mention it, but it is possible. The command is: 

Define a traffic class with the class-map command. Create a traffic policy by associating the traffic class with one or more QoS features (using the policy-map command). Attach the traffic policy to the interface with the service-policy command. 

Next, you must add interfaces to security zones. Normally I would recommend to put the "uplink" in a seperate zone, because that will make your policies much easier. I will assume that the uplink is in ge-0/0/0. If it really is impossible to predict in which port the uplink will be, you will have to put all interfaces in the same zone and figure it out with the policies. 

If that doesn't help, you're stuck with buying a bigger switch; EX3400 (the successor to EX3300) can handle 16000 ARP entries.