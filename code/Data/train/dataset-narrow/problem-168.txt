which is logical, since the vpn IS down. then I ran same on the other side (side A) it showed this: Index Remote Address State Initiator cookie Responder cookie Mode UP Main UP Main UP Main which is strange since again, the vpn is DOWN.. so, I tried to run this command: 

so, we have a SRX100 in one site (call it site B) and a SRX240 on our main site (Site A). the ISP at site B asked us to change our IP address from one network to another. (due to some routing issues they were faceing). the problem is that we have a site2site vpn between the two (ike). so, tonight I am sitting at site B, and want to fix this. I change all the setting on the VPN on both sites, to reflect the changes, and update any firewall rule that need updating for this to work. note 1) on site B, at this point I ADD the IP address in addition to the old ip address (I dit not replace it), but I did replace the default route, and the vpn connection end points. I then commit at site A first (since I have to do it while I can still reach it by vpn). then commit site B. I notice that I have internet stil on site B, which is good, but the VPN did NOT come up at all. I look in the logfiles on both sides (I have a secondary vpn to reach the site A switch). and there is nothing there! no trace of the vpn at all.. which is strange. then I notice that my ip as seen from outside is still the old ip address on site B (whatismyip.org or such). to, then I remove the old ip from the firewall.. and committ again (siteb). then, the VPN comes UP, and it shows in the logfiles like it should. so, I try to add the ip address back again to test, and the vpn goes down. and finally I try to remove the old ip on site B again... but the VPN does NOT come up.. and again nothing in the logs.. 

PS: site A has its own AS and ip series, and used BGP to route traffic to/from the two ISPs UPDATE 1: I have some clarifications, and also some new information (to futher complicate things). 1) SITE A has only one SRX, with each ISP on a separate port. ge-0/0/4 = isp1 ge-0/0/3 = isp2 today the site2site vpn St0 (used ip range 192.168.21.0/30 on the vpn), uses only isp1, but I would like to have isp2 as a backup. 2) Site B actually only has one ISP, but they have given us 2 different IP addresses, one of the addresses uses a special routing to their upstream provider (but only that network!), wheras the other IP address uses BGP and will use whatever routing upstream work.. so we have vlan.12 ip address 1) 6.6.6.6/29 (the one we use today) vlan.12 ip address 2) 5.5.5.5/29 (another ip we also want to use). So, the ip 6.6.6.6 gives us very fast speeds between the offices, as the route goes to the shortes path.. but it is limited to one provider, so the chance that it goes down is quite high. ip 5.5.5.5 is quite a bit slower, but is more robust to faults between the two networks. 

Does having configured on an interface prevent unicast flooding for a MAC address the switch hasn't learned? The information that I'm seeing conflicts -- the wikipedia page on unicast flooding cites protected mode as a mechanism to block flooding, while Cisco's documentation says that doesn't matter, and that would still be needed to prevent flooding. However, I recently ran into an issue where on a 2950G running some relatively ancient 12.1(22) code, unicast flooding seemed to be completely broken for a protected port -- the aging time on the switch was 5 minutes, while the router's ARP timeout was 30 minutes, and the one TCP connection utilizing this interface had a tendency to sit dormant for 10 minutes at a time - and be non-functional when waking up after 10 minutes in this case. Captures run on the host showed no unicast flooding when it was expected, and increasing the MAC aging timer on the switch to match ARP completely resolved the problem. Is this behavior undefined or inconsistent in older IOS versions, or is this just a bug in this old code? 

Flapping events don't require ingress traffic alternating between ports -- a simple change from ingress of a MAC address on port A to port B on a switch quickly enough will cause a flapping event to be logged; for instance, a live migration of a virtual machine from one host to another will often cause a MAC flapping notification. As the other answers have covered, it's nothing to be worried about whatsoever until the events are much more frequent than what you're seeing. Your concerns about spanning tree re-convergence and flushing of MAC tables are unfounded; it's not a topology change for spanning tree and the table is just getting updated for the MAC address that flapped - other entries on the same switch, same vlan, or same port are unaffected. 

That log entry led to several reports of this issue (1, 2) with information clarifying that this behavior was introduced as a security fix in CSCuc75090, but no real functional workarounds - just recommendations to use the established tunnel or NAT the users to a different address than the tunnel peering is happening over. Is there an effective workaround to allow for client VPN from these locations again? 

Configuration management software might be worth looking into -- Puppet's network device management can add vlans easily to numerous Cisco devices (if you're using Cisco). 

After upgrading our ASAs from 9.1(1) to newer versions, users were no longer able to connect using native IPsec VPN client software when inside of an office network. From outside networks it still worked just fine. The office networks have established VPN tunnels covering the IP range that the user's system falls under, but the workflow is to VPN in to gain access to restricted resources. We verified that disconnecting the LAN to LAN IPsec tunnel to the office allowed the client to connect in successfully. When debugging the connection attempt's IKE and IPsec, a log entry shows why this is failing: 

and then the vpn came up again... and I finally alro removed the other "old ip" line, and now only have one line (site A) 

noteA: vlan.12 is just a vlan that could easily have been a port such as ge-0/0/2, I have just setup the vlan to be able to use other physical ports on the SRX just in case. noteB: SITE B only uses one physical port to one and same ISP, but uses two different IP addresses. thanks again for the help so far. I will setup a service window to test tome of these things soon. update2: BGP setup on SiteA: 

We have two separate networks with SRXes on both sides (router, firewall, and site2sitevpn). On one side (Site A), we have two ISPs (BGP), and currently the VPN is setup to the IP address of one of our ISP (ISP1). but if ISP1 line should go down our VPN also goes down. is there a way to Automatically change the VPN tunnel IP address to the IP of the second ISP (ISP2) in the event that ISP1 should go down? or is that a stupid way to do it? Is is perhaps better to setup a 2nd VPN tunnel to the ISP2 IP address? if so, how can I automatically start the 2nd VPN if 1st fail? Map: 

and the vpn seems stable. I did not find this solution on any of the juniper FAQ, and googled a lot, but managed by a bit of luck to solve it. so I wanted to document it a bit here just in case someone (like me) need it. IF: I am completely wrong here, and what happened here just luck and not related, I do hope that you will comment or edit thanks! 

In the image above, you can see in red where the site2site vpn goes today. So in the end I would like to have redundancy so that all 4 combinations should work. 

I have a juniper SRX340 running as default gateway, I have a linux server (virtual machine actually) running debian 8. juniper ip: 192.168.1.1 Debian ip: 192.168.1.101 (eth0) I would like to add more ip addresses on my Debian box, so I create a new sub-interface and give it an ip debian ip2: 192.168.1.102 (eth0:1) when I do this, I can not ping the juniper box from the new ip address.. and juniper can not ping the new ip address. I CAN ping other hosts on the same network from the new ip address and they can ping it... all is well. so.. the new ip address can not see juiper box, and the juniper box can not see the other ip... so then I try something. I change the ip address of eth0 to be 192.168.1.102 and now I can ping the juniper box, and the juniper box can ping me back. then I change it back so that eth0: 192.168.1.101 and eth0:1: 192.168.1.101 and now juniper can ping both ip addresses, and both ip addresses can ping juniper. so.. then I take the test further and add a 3rd interface eth0:2 and give it the ip 192.168.1.103 and I have the same problem... I can not see juniper, and juniper can not see new ip... again, if I change the original eth0 to use 103 as ip first, then go back, it works again.. this is very confusing. any suggestions what is going on here? junos version 15.1X49-D100.6 update: I got some help on a juniper forum, and there is a solution (it is not perfect, but it works so I will use it for now). the solution is to add a static ARP on the juniper.