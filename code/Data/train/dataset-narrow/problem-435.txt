I have a table that is highly hit on my database. this table has 370,370 records. when I run the following select: 

but when I run the following script, to see how many rows I have in each year (because I partitioned per year) I get the following results: 

How can I find out the AD (active directory) account associated with that Proxy via T-SQL? SO far I have this script below, but something is missing. Also, the AD account might not be a login or user in the current server. 

but somehow dealing with the columns is upsetting the execution plan, causing some warnings related to conversion: 

I would like to log all these commands to a table before I apply them to my current server, but I understand these are sensitive information, and I would like to be able to encrypt it and be able to decrypt. What could I achieve this? I have already seen this: Is It Possible to Encrypt varbinary(max) Column Using Always Encrypted Feature? How could I achieve this, with minimal effort, and not affecting anything else on my systems? (I currently don't use always encrypted) 

Now I want to delete a specific record from my order table. this is the record I want to delete: Using the following script I generate a script to view all the records that I need to get rid of , before I can delete my in the order table. 

How can I have access to the backup files? Where are these azure permissions managed? EDIT: The answer by David Browne got me there, thank you David. I am just adding here a set of steps that took me to my backups (after successfully connecting to azure). 01 - Click on 

Now, this is not a complete solution, it is more my notes while restoring a replicated database, the troubleshooting I did, some ways to get around possible problems, and a tiny test at the end, before I let users know the db is active. Hope it helps 

I have a partitioned table that in real life has 80 million rows. for testing purposes I have created and partitioned this table here. when I run the following query: 

the questions: 1) [decCatItemPrice] is better off as an index column or as a column in the INCLUDE? how do you decide? I have taken my decisions through try and error, and this index arrangement is the one that reduced the logical reads number to the lowest as you can see on the picture below. 

I have inserted your values into a table variable just to so I could pivot from it later. The code came out like this: 

The impression that I got is that sql-server will look at the configured values in memory, and does not seem to realise that they have changed. How can I alter this behaviour? here is the full script: 

Now for testing purposes I will run the procedure and on a different window I will check if it is running, IMPERSONATING . to do this I use: 

this time I need to run the same job (that executes a SSIS package and takes about 8 min on average to run) for 15 times!!! is there a way to put a script together that will run this job 15 times? 

At the end, just so that I don't need to download the reports for them to edit, I have granted a very selective AD group with the contents manager permission, so that they can do their work. any better alternative please post an answer or comment, I will review the situation accordingly. 

I get this done through DMV's as you can see on the below script: (it is part of a more detailed script, but I just extracted the part relevant to you in this question) 

These security permissions can easily be scripted. this is an example: apologies foe the horizontal scroll, but that's how it is. 

Then in his great answer Dan Guzman, showed us SQL_VARIANT_PROPERTY some wonderful thing that I was not aware of, now I am a new DBA and person. 

Always drop a subscription in the publisher first to avoid this error. But if you happen to drop the subscription in the subscriber and get the error in the question above, the way I sorted it out was to go to the publisher server and publisher database and run the script below, that generates a drop subscription command for each article still pointing to the subscription. this is the script to generate the script to run: 

I see it is not a table within my database, but a . this is how I found out at what other object this is pointing to: 

and here is the query plan (it follows the unique constraint, rather than reading all the columns through the clustered index) 

I am currently doing a merge on the following table between my () and the same table on a different database called (). 

The writes are too high, it is a production system, I would like to have more support regarding this. Would I really benefit by creating these indexes? Is there any documentation that supports creating indexes on the distributor databases of transactional replication? Why Microsoft has not supplied these databases with the proper indexes on them? 

I have an user called mycompany\aives that is not listed in the list of administrators in the SSAS, not belong to any of the AD (active directory) groups listed there, however, he can connect to the cubes in this server (called SASBI01). if you see , however, the second picture, mycompany\aives is listed as one of the administrators on the box (SASBI01) Where does it say that the administrators on the box can (or not) connect to the cubes? How can I find out (preferably via script), a list of users that can connect to the cubes and their permissions? 

Basically every user would be free to navigate through the information, however, when a user presses the button, no one else can edit that record, although they can read it without a problem. let's say presses the button on id=4 . something like this: 

When I have a look at the tables that would be referencing my table I get the following list: script to find foreign key constraints: 

to check in your server, in all databases all the tables that are involved in replication and what are their subscribers I use the following script: 

2) I also have the reverse query (all columns come from the order table) but I still need to get ONLY the orders which have i.decCatItemPrice > 0 would the same index work for both? 

I found out what the problem was, just a TYPO in the servername/instancename. These scripts work fine to create a subscription in a sql server (2012-2008-2005) transactional replication. I would like to leave the question here though, for future reference, unless Moderators prefer me not to. In that case please feel free to remove it or just let me know. 

this is an example of a point in time restore. the database is called IntEng2 and it already existed, so it needs to be overwritten. it will be restored to this point in time: 2014-08-22T11:30:00 

and this looks and works great! this is the way I call this procedure: MY_LINKED_SERVER is another server, where from I want to get the logins to apply to my current server. 

What is the minimal permission I should grant in order for him to get this done? Any alternatives? (I was thinking about granting read only access to the reportServer database or something on those lines - but I don't want to make their lives too difficult ) I found this article very good regarding ssrs permissions: SQL Server Reporting Services 2012 Permissions Webpage were all the ssrs Predefined Roles are explained. 

I see the OLEDB wait type. Is this on its own, indication that I could do something to improve the speed of this connection? The Linked server script creation: 

but I cannot get hold of the error messages described on the pictures shown above. is there a T-SQL way to get to the errors/warnings related to the alwayson so that I can find out what is wrong? 

A question came to my mind though: what sort of data analysis should I do, to identify which of these columns would be better in the index or in the part? Plus, the order of the columns in the index, is there any starting point as to find out, for this query in particular, or other queries that might hit this table, the best order of the columns? There are no other indexes on this table. I cannot change neither the table definition nor the update statement, but I can add indexes. the solution On this occasion though, even after adding the index as planned, while monitoring the execution and using the very helpful procedure sp_blitzcache that I contacted the third party company requesting them to alter the procedure accordingly ( and sort out the updates as described in the comments and the accepted answer) sp_blitzcache in action: 

I use Azure to store backups, the backups are saved in Azure. this is how I am doing my backups and saving to azure: 

This means this job is already runing. You might want to stop it and start it again, if you really need to re-run it. 

Question: I am struggling to find any documentation on the stored procedure that I use to find out what the log reader agent has been doing: sp_MSenum_logreader_sd where can I find information about this procedure? I also would like to save this info into a temp table or table variable, so that when I spot an that is not zero I can get extra info as you can see below, based on the from the picture above. 

I have been working on a solution to synchronise logins (using T-SQL) between 2 servers, or between AlwaysOn nodes, inspired by sqlsoldier. It requires a linked Server. this is a partial view of the stored procedure I am using: 

where the has my varchar(max) in full. The question remains: How to save a varchar(max) to a file? Now running the following code I get the error message below: 

there are no foreign keys connection the item tables to the order table. although the column strBxOrderNo varchar(20) is on the primary key of both tables. 

I am looking for an indication (if any) that would either disregard the memory bottleneck option, or accept it, or make me investigate further. for instance: page life expectancy: 

Included in the code of the creation of some stored procedures, I have the enabling of data access as you can see below. 

for my own records I have a table in one of my servers where I like to save my activities and scripts the table definition is: 

what is working for me at the moment, is copying and pasting the script into word then following this link: Special characters you can use with Find and Replace in Word I can put all the "@" in a new line and other similar tricks: Is there any way of doing this level of formatting using SSMS? 

as this table is located in the database on my server, from my local machine I created a to the so that I can insert scripts into my table. this is how I insert a script into my table, the script is located on my local machine: 

/------------------------------------------------------------\ Identifying How Often an Auto-growth Event has Occurred When SQL Server performs an auto-grow event, the transaction that triggered the auto-grow event will have to wait until the auto-grow event completes before the transaction can finish. These auto-growth events cause your performance to degrade a little when an auto-grow event is taking place. For this reason it is best if you can size your database appropriately so auto-growth events rarely occur. If you are interested in how often an auto-growth event occurs on your system you can capture those events using a trace. By knowing which databases are performing auto-growth events allows you to adjust those database file growth properties so they will perform auto-growth events less frequently. You can use the profiler “Data File Auto-grow” and/or the “Log File Auto-grow” events to track these database auto-growth events. If you are running SQL Server 2005 or above, both these auto-grow events are already being captured by the default trace. If you haven’t turned off the default trace then you can use the default trace file to find these auto-grow events. If you have turned off the default trace you can either enable it, or setup a new profiler trace to capture the “Data File Auto-grow” and “Log File Auto-grow” events. The default trace logs to a file. I have provided the code in Listing 4 to show you how to extract all the auto-growth events from the default trace files. If you create your own profiler trace session to capture these auto-grow events then you will need to modify this script to meet your profiler trace settings. $URL$ marcelo miorelli 11-mar-2014 

you can see on the picture, the varchar(8000). can we avoid that? I would be happy with a varchar(50) 

I often have to alter jobs i.e. adding steps, changing the stored procedures the job calls, etc. and I always need to do the same thing on all servers in my availability group. when dealing with jobs, the in server A is not the same in server B for instance, so I always have to find the manually. how could I automate this? below is an example where I add an extra step to an existing job. I need to have a look at all the servers in the availability group and go server by server finding the and doing the changes. 

on the picture below, you can see, I have a sql server job called "Backup SSAS DBS_" that Run as: PowerShell_Proxy 

This is an example of the results of my query while I was trying to monitor some CXPACKETS WAITS. Pending_IO_count seems to be fine, but pending_IO_by_counts are always zero. what could be an alternative? I want to measure the I/O usage of each parallel process. in fact it could be just the I/O usage of each session or request. even sessions without request sometimes are good to see, because they might be blocking other processes. 

for the transaction logs, use the same script above with @backup_type CHAR(1) = 'L' see what you have inside your backup file doing a restore filelistonly 

I have realised some people are not so easy to deal with, I rather reduce their power over that server. I don't want to do their jobs, but I would like to restrict them from creating new databases, or overwriting existing ones, either by restoring or by attaching files, etc. They still should be able to create and run jobs, create\alter any object withing user databases, create logins, grant permissions etc... Basically the question is: How to limit the power of a current sysadmin? I thought about not granting sysadmin but a set of server permissions (excluding those to create/alter databases) that would allow them to do everything else. what would that set of server permissions be? 

And when I have done the tests, and found out the user can run the script then I come back to be me: 

This is the full XML execution plan of the query and picture above. This is another picture using another tool to compare execution plans. 

TITLE: Microsoft SQL Server Management Studio Either the 'mycompany\MMiorelli' user does not have permission to alter the 'myserver\instance' object, or the object does not exist. (Microsoft.AnalysisServices.AppLocal.Core) 

this script looks for all databases to find every place where a specific stored procedure lives, but if you leave the parameter out, you would get a complete list of all stored procedures. 

the script below will list all the primary keys, that have at least one or in their columns. You can filter further or tailor the query more but it should be a good starting point and hope it helps. 

this script gives the permissions assigned to a table or stored procedure in a script format. have a look what it returns for your that could be a start. 

When I then run the query, I notice it takes longer than the original without index. the new query plan, after creating the index is as follows: 

In order to make it easier, so that I can pass any procedure name that exists on I have extended a the permissions granted, but consider the implications of this in your own environment. 

I have a few databases involved in replication as subscribers and they have triggers and are used by a different set of applications. Every time I need to reinitialise those database I need to script the triggers, permissions and indexes, apply the snapshot and then re-apply those triggers, indexes and permissions. Is there a script that I can use to script all the triggers of a current database? 

Questions Is there a way to make sure the database setting will prevail over the management studio settings? I thought about creating a plan, and use OPTION (USE PLAN) but that has other consequences that is beyond the scope of this question.