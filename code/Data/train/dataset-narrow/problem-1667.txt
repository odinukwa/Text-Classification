Or manually (you may want to handle tun0) in the VPN startup script), but I would configure eth0 with /etc/network/interfaces 

Sendmail won't know which host the client connected to. You'll need to lookup the hostname and use it in creating your addresses. Sendmail will send from one IP address. This is normal behavior, and you are unlikely to be penalized by recipient's servers because of this. However, if you do generate spam and get blacklisted all traffic will be penalized. Configuring an address so it is considered a trusted sender takes a little work. Get the one IP address sendmail is using setup correctly. 

As you haven't configured the users to login using a desktop mangager, they likely need to configure their session using a file. It may be simpler to configure VNC using XDMCP to start the session. I've had success running Remote Desktops with VNC and RDP. For VNC sessions, it worked better using XDMCP. Using XRDP, the desktop gets launched by the XRDP daemon. 

From your question it appears you have a number of computers infected with botnet software. It is important you identify and cleanse these systems. That is beyond the scope of this question. If your routers support it, consider limiting the IP addresses which can originate requests. 

WARNING: Your IPv6 addresses will be globally routed, ensure you firewall traffic to and from the Internet. Don't assign services to link-local addresses. Assign a separate /64 to every internal subnet. Assign a fixed IP address to servers and routers. These can be entered into DNS. (Some IPv4 DHCP/DNS servers will identify the corresponding IPv6 address using the associated MAC address.) You should configure RADvD and/or DHCPv6 to handle address assignment. IPv6 addresses are generally self-assigned based on one one of these services. DHCPv6 allows you to assign fixed IP addresses. If you are not getting a static prefix (which you should), the configuration of the address assignment will need to update when the prefix change. (It is not that important that your external address be static as the route to your prefix should update appropriately.) IPv6 privacy works by periodically assigning a new IP address for outgoing traffic. Don't be surprised to see multiple global IP addresses on you devices. 

Try shorewall which provides a reasonable firewall out of the box. Enable access from net for the services you want. There are example rule sets for one, two, and three interfaces. The documentation is good and it is actively maintained. I expect you will want to limit which addresses can access MySQL which is easily done. You can also secure SSH with port knocking where the port is closed unless you have probed the another port recently. 

The message should have been rejected based on the domain in the return path and/or the domain in the HELO command. Try to configure your server to reject mail based on these factors. I would consider accepting the message is a configuration issue for the mail server. I believe OpenDKIM behaved correctly signing a message from a local address despite the external IP address. This would be the behavior if you had authenticated from the internet before sending. 

There are a several simple rules that can be used to block most spam servers. Some will block legitimate but poorly configured servers. 

If you have a lot of jobs defined like that you are asking for trouble. Unfortunately these are often long running system jobs. I also tend to schedule jobs at different hours throughout a batch process window. (23 to 05) hours. I like the new cron specification used on Ubuntu. This has several directories to specify jobs to run. They get run in sequence rather than parallel limiting the load. You should be able to see what is scheduled in the files located in . Reading these files will require root access. If it is users who are causing the problems discuss the problem with them. You could also check for CRON entries to see what is being run when. 

Keystores are simply files in a format used by java for storing keys and certificates. They do not contain any information which ties them to a particular system. They can be freely copied between systems and directories as required. They may be password protected, in which case you may need to arrange to have the password available to the software using it. There is a program which can by used to read and/or update the keystore. It is often possible to read keystores without a password. Keystore may contain keys tied to a system's domain name. These keys are not as useful on other system. 

You have no rule to allow outgoing, although your rules for ports 22 and 443 appear to be bi-direction. You should be filtering ICMP on the external interface, and allowing DNS traffic on port 53 (both UDP and TCP). I would recommend you use a n IPv6 capable firewall builder. There are ports that you likely want to block outgoing traffic on even if you want an open policy on outgoing traffic. A good firewall builder will have some default rules that get you started with a reasonable firewall. 

I run Shorewall as the firewall with a log drop policy. I use a dshield log parser to report port probes to dshield.org, and copy me with the log file. The logcheck tool also scans my logs once an hour and report any interesting data. I find port scans are not done that frequently now. It may be that use of tools like fail2ban makes port scans not that attractive any more. 

I have a post on Running an Email Server with some other comments. Its a bit of a rant as several legitimate posters send email that looks very much like Spam due to poor email implemenations. EDIT: Typically services like , , and have service related names (sub-domains). In some cases these will have numerical suffixes like or . This makes it simple to provide the services on different servers simple. The servers usually have their own hostname (sub-domain) which is unrelated to the sevice(s) they provide. These days the domain may be used for web traffic, but is is often immediately redirected to the web sub-domain. 

Try selecting "Only allow loopback connections". This requires a restart of the service. It appears this does not apply to the web server that serves up the Java client. I usually disable this service anyway. Verify with the command and checking which addresses are listening for port 5900. If the change has been applied correctly, only should be listening. 

Copying messages to a folder is normally done by the Mail User Agent. I am not aware of a switch to that would do this. However, you could add you userid to the list of addresses on the command line to get a copy of the message. There should be a switch to deliver the copy as a blind carbon-copy. The copy will contain a subset of the headers that exist on the message when it is finally delivered. It will contain the key headers such as , , , and . Other headers get added as the message is passed from server to server for delivery. 

Don't assign the user id or group id 0 to the user you are targeting. Add the user to as specified. Then flag that will be uses also as documented. will be used to run command as root (user id 0, group 0) when needed. 

If you are open to changing your email software, Exim allows you to add the Subject to the log. It can also be built to allow access to a database from the configuration file. This can be used to log whatever information you want. It is functionally equivalent to sendmail. 

DNS data is cached. If you didn't reduce the TTL before the move, then entries can be cached until they time out. If you can configure your old server to defer rather than reject email arriving from the Internet, the messages should eventually be delivered to the correct server. Alternatively, and likely more appropriately configure the Exim server to listen only on localhost. Legitimate servers will retry for a few days before bouncing the email. That should be sufficient time for them to find the correct MX record. 

Consider adding an SPF record like to the DNS entries for each SMTP server. This will allow recipients to verify that this server is intended to send mail. (SPF can be used to verify the server as well as the sender.) While it is common for the MX servers to also be the outbound mail servers, it is not necessary. List the outbound SMTP servers in the SPF record for the domains used in email addresses (usually rather than ). Your SMTP servers should belong to one domain. The MX servers for a domain do not have to be in the same domain. If you are configuring multiple domains, pick one for the mail servers and use that for all the domains. In larger installations, it is common for the border (externally facing) SMTP servers to forward to internal mail servers for final delivery of incoming mail. All outgoing mail should be sent to the border servers for delivery. If you have split your incoming MX (mail exchange) servers from outgoing MTA (Mail Transfer Agent) servers outgoing messages should be sent via the outgoing MTAs rather than the MX servers. It is a good idea to include in the SPF records anyway. This will allow your MX servers to send delayed delivery notifications without the message being considered spam. For roaming users you may need authenticated SMTP access to allow the users to send email. This is best done on the Submission port (587) rather than the SMTP port (25). This should be secured with TLS (SSL) using the command after connecting. Authentication should only be allows on encrypted connections. This can be offered on the servers configured above, or on the servers providing IMAP access. Depending on your needs you can use an IMAP server that supports proxying connections, or just allow the users to connect to the server for their domain. It is common to use a service domain for this purpose, usually or . These can be configured in DNS as records or . Many mail clients will auto-configure correctly to the common service accounts for the domain. If is entered as the user during configuration, the software is likely to find service domains like , , and It is relatively common to use different service names for IMAP and STMP traffic.