Spanning Tree is not a routing protocol, but a protocol to avoid loops in a network. Therefore, whenever the network topology changes (links comes up/goes down), Spanning Tree is gathering information about the network and the link between all involved switches. It does then determine a root bridge (= root switch), and starting from that root bridge defines which links are to be used to distribute data from one point to the next. After Spanning tree is done, there will be exactly one link in use for every possible connection, and the others links will be blocked (disabled). However, this is a protocol operating on Layer 2 of the network, and has nothing do with IPs or routing. 

We are operating several Cisco 2960S stacks here and, for some time, are experiencing regular Spanning Tree TCNs (Topology Change Notifications). When using show spanning-tree detail to get to the source of the TCN, they originate from different 2960S stack members. As the config has been transferred from older switches, the ports are configured as trunks, with the data VLAN being the native VLAN and the VoIP VLANs being included as tagged in the trunk. I know, today the correct configuration would be switchport mode access combined with switchport voice vlan - but at the moment it is at it is. Part of the problem was based on the fact that some ports were only configured as portfast, not portfast trunk, so this has to be fixed, as the portfast only command is not applied to ports in trunk mode. However, some ports are configured as portfast trunk, which as of my understanding of Cisco documentation, should avoid generating TCNs on link changes. Sadly, they do. Executing show spanning-tree interface Gi1/0/x portfast shows portfast enabled for all VLANs on that interface, but show spanning-tree detail together with show logging shows that these interfaces are indeed the source for the Spanning Tree changes. It is made sure that there are no "special" devices connected to those ports, just VoIP phones and desktop workstations. The version run is 12.2(55)SE3, the devices are 2960S-48LPS-L and 2960S-48FPS-L. Looking for known bugs, there was a bug in a 12.1 release for 3550 switches that caused such behaviour, but this is the wrong device and a much older version, and I guess somebody should have experienced that bug before. Any idea where to look, what to try? 

and then the vpn came up again... and I finally alro removed the other "old ip" line, and now only have one line (site A) 

We have two separate networks with SRXes on both sides (router, firewall, and site2sitevpn). On one side (Site A), we have two ISPs (BGP), and currently the VPN is setup to the IP address of one of our ISP (ISP1). but if ISP1 line should go down our VPN also goes down. is there a way to Automatically change the VPN tunnel IP address to the IP of the second ISP (ISP2) in the event that ISP1 should go down? or is that a stupid way to do it? Is is perhaps better to setup a 2nd VPN tunnel to the ISP2 IP address? if so, how can I automatically start the 2nd VPN if 1st fail? Map: 

and the vpn seems stable. I did not find this solution on any of the juniper FAQ, and googled a lot, but managed by a bit of luck to solve it. so I wanted to document it a bit here just in case someone (like me) need it. IF: I am completely wrong here, and what happened here just luck and not related, I do hope that you will comment or edit thanks! 

You're confusing routing protocols with the actual routing. Some routing protocols actually know the whole topology of a network, while others only know the routing table of their neighbors. All of these protocols share that they're used to fill the router's routing table, so it can make decision about which is the best path for a packet to a given destination. To make that decision, some routing protocols actually gather all network topology information, so that they might actually know or at least guess the complete route a packet might take - but that is not their decision. Every router takes the decision which way to forward a packet in the very moment the packet arrives, depending on where it's destination is. 

Forwarding is the term used for the action done by any station participating in the distribution of a packet that is neither the source nor the destination. Host A is the source or sender, Host B is the destination or receiver. All routers in between them will only be forwarding the packet, as they are neither source nor target of that communication, but just relays. I have to correct myself on that point. Forwarding, in networking terms, usually refers to "relaying data that you received for somebody else on Layer 2". Switches forward frames they receive, by determining if their Forwarding Table/CAM Table (Cisco) knows on which the port the destination MAC address is, and then sending it there, or flooding it on all ports if they don't know where the destination MAC address is located. Routers route. (Ha!) They do the same as switches, but on Layer 3 (IP). They take a look at their routing table to determine where to send a specific packet on it's journey to it's destination IP. Often, forwarding and routing are mixed up (like I did), but in network terminology, forwarding is Layer 2, routing is Layer 3. 

so, we have a SRX100 in one site (call it site B) and a SRX240 on our main site (Site A). the ISP at site B asked us to change our IP address from one network to another. (due to some routing issues they were faceing). the problem is that we have a site2site vpn between the two (ike). so, tonight I am sitting at site B, and want to fix this. I change all the setting on the VPN on both sites, to reflect the changes, and update any firewall rule that need updating for this to work. note 1) on site B, at this point I ADD the IP address in addition to the old ip address (I dit not replace it), but I did replace the default route, and the vpn connection end points. I then commit at site A first (since I have to do it while I can still reach it by vpn). then commit site B. I notice that I have internet stil on site B, which is good, but the VPN did NOT come up at all. I look in the logfiles on both sides (I have a secondary vpn to reach the site A switch). and there is nothing there! no trace of the vpn at all.. which is strange. then I notice that my ip as seen from outside is still the old ip address on site B (whatismyip.org or such). to, then I remove the old ip from the firewall.. and committ again (siteb). then, the VPN comes UP, and it shows in the logfiles like it should. so, I try to add the ip address back again to test, and the vpn goes down. and finally I try to remove the old ip on site B again... but the VPN does NOT come up.. and again nothing in the logs.. 

Although this question is rather old, someone may find it while googling the very same problem, so here comes our "solution": We couldn't figure out the source of the problem, as the problem was non-reproducable and only happened about once a day on varying access-ports, with about 500 access-ports with the exactly same config in use. After updating all 2960 to a release from the 15.x line, the problems disappared. The config didn't change, so it seems to have been silently fixed in one of the releases in between. 

The default gateway, some kind of router, will then take a look in his local routing table and, based on the destination IP address, forward the packet to the next router. It doesn't care how that router is going to get the traffic to host B, it only knows "This is the next hop on the way to the destination network". At some point, the packet will arrive at a router which is directly connected to the same network as host B. That router will then send the packet to host B. Every participant in that process only decides where the next hop for a packet is, and send the packet to that station. They will not know or take into consideration the complete route the packet has to take - only the next step. 

noteA: vlan.12 is just a vlan that could easily have been a port such as ge-0/0/2, I have just setup the vlan to be able to use other physical ports on the SRX just in case. noteB: SITE B only uses one physical port to one and same ISP, but uses two different IP addresses. thanks again for the help so far. I will setup a service window to test tome of these things soon. update2: BGP setup on SiteA: 

I have a juniper SRX340 running as default gateway, I have a linux server (virtual machine actually) running debian 8. juniper ip: 192.168.1.1 Debian ip: 192.168.1.101 (eth0) I would like to add more ip addresses on my Debian box, so I create a new sub-interface and give it an ip debian ip2: 192.168.1.102 (eth0:1) when I do this, I can not ping the juniper box from the new ip address.. and juniper can not ping the new ip address. I CAN ping other hosts on the same network from the new ip address and they can ping it... all is well. so.. the new ip address can not see juiper box, and the juniper box can not see the other ip... so then I try something. I change the ip address of eth0 to be 192.168.1.102 and now I can ping the juniper box, and the juniper box can ping me back. then I change it back so that eth0: 192.168.1.101 and eth0:1: 192.168.1.101 and now juniper can ping both ip addresses, and both ip addresses can ping juniper. so.. then I take the test further and add a 3rd interface eth0:2 and give it the ip 192.168.1.103 and I have the same problem... I can not see juniper, and juniper can not see new ip... again, if I change the original eth0 to use 103 as ip first, then go back, it works again.. this is very confusing. any suggestions what is going on here? junos version 15.1X49-D100.6 update: I got some help on a juniper forum, and there is a solution (it is not perfect, but it works so I will use it for now). the solution is to add a static ARP on the juniper. 

In most cases, communication happens between workstations and servers, which don't participate in any routing protocol nor do they have any further knowledge about the network topology. Most hosts only know 2 things: 

Equal-cost multi-path routing is simply a way to distribute traffic with the same source and destination over several links, which all have the same "cost". Imagine it like this: You're going from Los Angeles to New York (by car). Checking Google Maps, you find out that there are two possible routes, one via Denver, the other one via Albuquerque. Both routes are exactly 2800 miles long and take exactly the same time. You, as a driver, would now have to equal-cost routes to choose one from. However, as a network packet, you don't make those decisions, but the routers make them. The router in LA could now choose to send the first packet via Denver, the second via Albuquerque, the third one via Denver and so on. It would result in both links/routes being equally used, without having a traffic jam on one route and no traffic on the other one. In short - it's just a way to distribute traffic over to equal links to avoid congestion. 

this worked right away. I am still interested to know why juniper does not add these automagically like you would think, but I have a deadline and this will work for me today.but I doubt that this forum will help any. 

PS: site A has its own AS and ip series, and used BGP to route traffic to/from the two ISPs UPDATE 1: I have some clarifications, and also some new information (to futher complicate things). 1) SITE A has only one SRX, with each ISP on a separate port. ge-0/0/4 = isp1 ge-0/0/3 = isp2 today the site2site vpn St0 (used ip range 192.168.21.0/30 on the vpn), uses only isp1, but I would like to have isp2 as a backup. 2) Site B actually only has one ISP, but they have given us 2 different IP addresses, one of the addresses uses a special routing to their upstream provider (but only that network!), wheras the other IP address uses BGP and will use whatever routing upstream work.. so we have vlan.12 ip address 1) 6.6.6.6/29 (the one we use today) vlan.12 ip address 2) 5.5.5.5/29 (another ip we also want to use). So, the ip 6.6.6.6 gives us very fast speeds between the offices, as the route goes to the shortes path.. but it is limited to one provider, so the chance that it goes down is quite high. ip 5.5.5.5 is quite a bit slower, but is more robust to faults between the two networks.