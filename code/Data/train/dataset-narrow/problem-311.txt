Everything you're talking about is scoped by the L2 VLAN. When servers communicate with the router or other servers, they will be doing so with packets/frames that will only be seen in the VLAN that they're sent on. The only way packets/frames can cross from the original VLAN to a different VLAN is via the router. From the router's perspective, all the data mentioned with be tagged with the appropriate VLAN tag. The switch is adding the tag to the data from your servers depending on the VLAN assignment on the port. Since the router is Router-on-a-stick (802.1q trunk), it has to be able to differentiate traffic between different VLANs. The only way it can do that is with the VLAN tag that was added by the switch. Any responses are also tagged with the appropriate VLAN tag before sending across the trunk back to the switch. 

ASA version 9.1 configured with SSL VPN to Windows AnyConnect Secure Mobility Client version 3.1. VPN Filter ACL is configured to allow all traffic and ICMP, and is attached to group policy. Problem: VPN connects successfully (AnyConnect client says "connected") but cannot route any traffic over the VPN. Cannot ping any internal host behind the ASA, Observations: Internal network (behind ASA): 10.111.11.0/24 Network on client computer: 192.168.1.0/24 (sits behind another ASA - that is not relevant though because doesn't work on other n/w having no ASA firewall either) ASDM reports one AnyConnect session active on the ASA. Reports also that the above ACL is going to be used. The first rule of that ACL (see below config) got 1900 hits so traffic arrives but seems to not find its way back? VPN ACLs are meant to automatically be bidirectional so it SHOULD work. On the Windows client computer I can see a Cisco network adapter has been created when the VPN connects with IP address 192.168.20.1. Network configuration claims that 192.168.20.2 is the default gateway, which should be the ASA - but I cannot ping 192.168.20.2. A "route print" on the client computer shows 192.168.20.2 to be the default gateway as well. (These addresses are valid - they are assigned from local pool RemoteWorkerPool 192.168.20.1-192.168.20.254, see below config). I cannot ping the client IP address (192.168.20.1) from within the ASA (does the AnyConnect client respond to the ping usually?) Running a "show vpn-sessiondb detail svc filter name " command shows "Filter name: RemoteVPNACL" in the SSL section, which fits to my configuration - the ACL is being used. SSL Ciphers: A "show ssl" command brings up the following: 

Of course, all of this will need to be done in a maintenance window. You should only expect traffic interruption on the line card in question, but leave yourself a "the switch might reset" clause in your maintenance window description. Best of luck! 

First, we create a class-map to match our GRE keepalives. Note that this will actually over-match and includes all CS6 traffic. This likely includes other routing/bridging protocols. Not necessarily a bad thing, since the failure of the routing control-plane would bring the path down completely. You might consider also prioritizing other high-CS classes for control-plane or voice. Next, we create a queuing policy-map for Fa0/0. This will control how each class of traffic is treated during congestion. In this case, the only class we define a policy for is CS6 (GRE keepalives and other control-plane traffic). We say that CS6 traffic is allocated 5% of the available bandwidth in a priority queue. That means that if there is CS6 traffic queued, it will always be sent on the link first (up to 5% of the link bandwidth). Any traffic above that 5% will be sent best-effort with the rest of the traffic. (See this doc for more information on priority vs bandwidth allocation.) Now it's time to replace your ancient 1962 Pinto CAR! Create a policy-map for shaping on Fa0/0. We want this shaper to apply to all traffic, so we only define a policy for class-default. Shape to 9.5 Mbps. Then nest our queuing policy. This means that traffic will be sent FIFO as long as there is bandwidth available. As soon as traffic reaches 95Mbps, the router will start queuing packets and will dequeue them according to PM-FA0/0-QUEUE-OUT. Next, we do a little future-proofing. By default, the service-policy on the interface will inspect already-encapsulated traffic. The router will copy the DSCP marking from the inner IP packet into the outer GRE header, so you'll still be able to read those. But if you ever implement more complicated class-maps (using access lists or NBAR), the router will be blind to the internal contents of the GRE packets. "qos pre-classify" makes a copy of the packet before encapsulation and uses that for QoS inspection rather than the GRE-encapsulated packet (more reading). Finally, your complete QoS policy is applied to the physical interface (not the tunnel!). Applying the shaper ensures your traffic is queued at 9.5 Mbps, and that any queued traffic is dealt with according to the queue policy you setup. Side note: There is no benefit in rate-limiting your traffic inbound. You are only attached to one other endpoint, and you know for a fact that its shaping to 9.5Mbps. Assuming there's not more to your topology, its safer to not try to control the inbound traffic. Hope this helps! 

Is it correct that the SIP inspection in the ASA 5500 firewalls only kicks in for traffic on port 5060? The referenced document below states so (this doc is specifically for the newer generation 5500-x series). And I have trouble to get audio working when my IP PBX is configured to receive inbound calls on another port than 5060. The IP PBX I am using is a SIP proxy with a built-in SBC and it demands that inbound traffic shall be sent to port 5080. Traffic between IP PBX and ITSP goes via an ASA 5505 firewall (that's the older generation). Inbound Calls do connect, but then I have one-way audio. The RTP does not flow from external to internal. (Outbound calls are no problem, all fine with 2-way audio - but they are sent with destination port 5060). This would make sense if the ASA won't start the SIP inspection due to the different port 5080. But is that really the case? And if that is so, can I configure somewhere which SIP port the ASA should look for? Or is there any workaround? (I can probably open all inbound RTP ports ... but I would like to avoid that) Cisco documentation ASA 5500 

All that we mean by "ECMP" is literally "Equal Cost, Multi Path". The router installs two same-cost paths to a given next-hop, and they are used equally. OSPF makes the routing decisions for the network based on its LSA database. If there are two paths that have the exact same cost from OSPF's perspective, it will consider them both "best". The router installs both equal-cost paths into the routing table, and the concept of "ECMP" occurs. Half of all flows will be sent one way, half go the other. One of the benefits of EIGRP is that it supports unequal-cost multipathing via the "variance" command. OSPF, IS-IS, and all other IGP protocols I know of in the Cisco world only do equal-cost multipathing. 

A line card swap is exceedingly simple. You'll need to make sure that the replacement card is the exact same model as the old one. You can certainly bring TAC on the call with you to do the swap if you want help. 

Finally, assign the policy-map to an interface; asa(config)# service-policy SIP_Policy interface [name of your interface] 

Seems that the trick is like that (credit to Alex over at serverfault.com): First go in your configuration terminal and create the class-map; 

This also seems okay - I use username / password authentication. I could not find anything in Cisco documentation that the 3.1 client would not work with ASA version 9.1, but it's not 100% clear. Solution Attempts: Configuration was originally created by ASDM wizard and resulted in this problem. Have re-created the configuration plainly from CLI, same result. Connected the Windows client to another internet connection which is not behind any firewall. Same result - VPN connects but no traffic can flow. Have configured IPSec VPN for AnyConnect on top of this configuration - same result, I get a connection, but no traffic flows. The Cisco VPN troubleshooter did not give me any useful hint. I am sure there is a very basic error somehwere, but cannot find it. I am lacking knowledge on how one goes about debugging or troubleshooting AnyConnect VPN connections apart from above. Configuration (relevant parts): 

Looks like you CAN do static null0 routes in ASA 9.2(1). You would then redistribute the static into EIGRP. $URL$ 

It appears from your question that the 2960 is the "core" or central switch. The most straightforward answer is to create a SPAN port on the central 2960 and feed it into your other PC. Then you can use a tool like Wireshark to look at the data. 

Your best bet is to tap the links themselves. Use an in-line optical tap or a powered copper tap. This will split the connection off to a secondary cable, which you can then plug into your server for monitoring. You'll have an instantly-accurate, infinitely-granular picture of what's going across the wire. Edit: If you've got too many links to tap, your only other option I can think of is to SPAN all the ports to a single 10G or 40G interface and monitor that. Keep in mind that you're adding in the processing time for the SPAN, and you may drop traffic depending on oversubscription ratios, etc. Just depends on how much accuracy you really need. The only way to get a 100% complete, guaranteed measurement of the bandwidth crossing a given link is to tap the link.