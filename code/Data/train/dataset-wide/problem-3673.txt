When you see "!Z" or "!X" in a traceroute, what does that mean? Where is it coming from, and how do I fix it? 

You should avoid trying to do this with PHP. By the time PHP gets involved, it's already too late - the memory has already been allocated. You can ban IP addresses at any layer, but the lowest level that uses the least amount of resources is the route you want to take. This is usually the firewall. At the very least, iptables (linux firewall) is what you want to use. There are tools that others have mentioned, such as Fail2Ban, that can automate this for you. External firewall would be better. Besides trying to ban offending IP addresses, you should try to make better use of your resources. If a request takes less resources it will take longer for an attack to be effective. Apache also uses a lot of memory. If you're using mod_php, it's even worse because PHP is loaded inside of every Apache child process. This means even requests to static content (css/js/images) are loading PHP even when PHP isn't being used. You can solve this problem by using FastCGI instead. mod_fcgid is a good option. There are also other web servers that are more resource efficient. Nginx is my favorite. There's also Lighttpd. A lot of people like Litespeed (drop in replacement for Apache). If you want to stick with Apache, consider tuning it as best you can. Consider disabling .htaccess. Here's a good explanation why. 

VMware tools wouldn't have anything to do this. It's an optional package. You say it's not the firewall because you stopped it with . Still, I would try , which will flush all rules (until you reload the saved config). Here are some questions / things to try: 1 - Which machine are you pinging from? Is it also on the same ESXi host, or outside the ESXi's virtual switch? What happens when you ping it from another virtual machine on the same host? 2 - What happens when you try to ping something else from this VM? 3 - What does a traceroute show to/from the VM? 4 - Do you have any VLAN id's configured? 5 - Does the MAC address listed in match the adapter mentioned in VM -> Edit Settings? 6 - What Ethernet driver do you have configured for the VM? 7 - Have you tried installing a fresh VM? 

I've setup a port knocking scheme to protect port 22 using iptable rules. On top of that I've setup some "honey pot" rules to disable port knocking for the client for several minutes if they hit common ports that are not used (port 21 for example) or ports around the knocking sequence. This seems to work well (I believe it's a better option than changing the port to something obscure). For SSHD password logins are disabled anyway - an encrypted private/public key combo is required. On this page there is a "drip pan" scheme that if unused ports are hit the client cannot communicate with anything (even open ports) for 60 seconds. My biggest concern is "--hitcount 3" seems to be triggered by any simple request to a single port. So my question is, what do you think about this kind of setup? Is the "drip pan" too much on a web server, or just right? Other than keeping a drop in-out policy and only opening what is needed, do you guys have any other firewall security advice? Edit: I'm using CentOS 5.7. We're assuming as "secure as possible within reason". A server would have to pass PCI/SAS compliances (and other similar standards). Focus would be the firewall, not necessarily vulnerabilities with individual services that could come be discovered (that's another topic). Anything that I'm missing related to the firewall or anything on the outside. Want to make it as difficult as possible for an attacker to gain access. 

I'm using the CentOS 6 netinstall ISO with some kickstart files on an http server. When the ISO boots I hit TAB and enter the boot options . My kickstart files do not have a parameter, so it should be prompting. When I leave out it tries to use DHCP. With it only prompts for IP information. Unfortunately anaconda is hell bent on automatically discovering the hostname, which ends up being a reverse DNS lookup of the IP, or if nothing was found. Is there a way to make anaconda prompt for the hostname, or some way to pre-enter it through a custom boot option? There used to be for CentOS 5, but this no longer works in 6. 

I finally figured this out after working with physical switches, some trial and error, and further reading. This can be a very confusing because a "trunk" can mean different things with different vendors. It basically means a port that is "tagged" with 2 or more VLAN IDs, or with some vendors all VLAN IDs. With a vSwitch a "trunk" port is "All (4096)" which means all VLAN IDs. With VLANs there are "tagged" and "untagged" VLANs. A tagged VLAN adds extra information to the ethernet frame to indicate which VLAN a message belongs to. An untagged VLAN doesn't add this information, and strips VLAN tag information matching its VLAN ID. A "tagged" VLAN is useful for expanding a VLAN across more than one switch (physical or virtual). On a physical switch a switch port can only be attached to one untagged VLAN, but can be "tagged" with multiple "tagged" VLANs. A switch port is always associated with at least one untagged VLAN, with some vendors VLAN 1. The tagged VLANs take precedence. Devices plugged into a switch port with a tagged VLAN must understand what a tagged VLAN is and attach the correct VLAN id. If the recipient is plugged into an untagged VLAN of the same ID, this information is stripped before it receives it, so it doesn't have to understand what a VLAN is. With a nested ESXi environment, the master ESXi host acts as your physical switch. If you tag a port group on a nested ESXi host with, for example VLAN 100, the master ESXi host won't know what to do with the VLAN tag information. Because of this the master ESXi host needs to be on VLAN 100 OR (for other VLAN's to work) "All (4096)". In a real environment you may not want to trunk all VLAN IDs on an uplink. If you have a vSwitch that has port groups with multiple VLAN IDs, you have to at least tag these uplink ports with those VLAN IDs in order for a VM to communicate with another VM on another physical host. Otherwise only VM's on the same physical host will be able to communicate. The vSwitch really hides a lot of stuff you'd see on a physical switch. 

Can I assign individual ports on a single adapter to different vSwitches? In other words can I assign 2 ports for SAN and 2 ports for LAN on a 4 port nic? 

I have 3 ESXi hosts, each with 4 uplinks dedicated to a port group. I want to utilize each of these uplinks for incoming/outgoing traffic (load balancing). From what I understand I need to setup link aggregation and on my Force10 switches (stacked) and set IP Hash based load balancing. VMware KB article 1021492 shows how to do this with Force10. What isn't clear to me is, how many port channels do I need to setup? One per ESXi host, or one for the entire port group? Does it matter? 

Unfortunately won't work with status codes other than 200, 204, 301, 302 or 304. You can find this in the documentation here. You may be able to use this plugin to do what you want: $URL$ 

I was reading an article on Linux Journal about Memcached and it mentions Netbooting multiple servers off a single root image: 

I'm following this guide in setting up a nested ESXi 5 lab on a single box. It has you create 4 ports for each virtual ESXi box, 1 on VMNetwork and 3 on a Trunk port group. It says you need to do this to be able to create VLANs on the virtual ESXi boxes. How does this work exactly? Is the VM Network port any different than the Trunk ports? The virtual ESXi boxes don't show the same distinction. I'm having trouble wrapping my head around why/how this is necessary. 

We have a debate in our office going on whether it's necessary to get a hardware firewall or set up a virtual one on our VMWare cluster. Our environment consists of 3 server nodes (16 cores w/ 64 GB RAM each) over 2x 1 GB switches w/ an iSCSI shared storage array. Assuming that we would be dedicating resources to the VMWare appliances, would we have any benefit of choosing a hardware firewall over a virtual one? If we choose to use a hardware firewall, how would a dedicated server firewall w/ something like ClearOS compare to a Cisco firewall? 

We're in the planning/development stage for our new platform and with everything separated out we'll need to setup between 9 to 16 servers, a load balancer, 2 or 3 hardware firewalls, and a VPN. During development we need to simulate all of this as cheaply as possible. Ideally I'd like to be able to setup a single machine with a lot of RAM and virtualize all of this to figure out what works and what doesn't. What are my better options as far as virtualization? VMWare? Other? How can I virtualize all the appliances as well? The appliances our data center offers: Cisco ASA 5510 (firewall), Foundry FCSLB8 Serveriron XL (load balancer) (We'll be running CentOS 6 64bit on our servers) Looking for something super easy. Something that will help me learn the real environment for later on. 

The company I use ranges from $136-$495 per month, per server, ranging from low-end (AMD Athlon 64 X2 4600+) to enterprise (Intel Dual Xeon X5650, A/B Power). The biggest pro for renting a server is if hardware fails they replace it for you. But if you have enterprise servers, $400+ a month can get expensive. At what point would colocation be more cost effective? As in, how many servers would have have to be renting for colocation to be better? Any other pros and cons? 

Did you create records on your domain for your DKIM public key? If not, there's no way for Gmail to validate it. Do you have any records setup to validate that your server can send emails from the domain? Is it configured correctly? There are also tools on the internet that will help you troubleshoot issues. A search like "DKIM validator" should give you some tools to verify the DKIM record is visible. Also, what do the headers say? Sometimes email servers add headers to indicate the reason why a message was sent to spam. 

I need to deploy vSphere Server Appliance 5.1. I have vSphere Client running locally and my internet upload is capped at 3 Mbps. It says it's going to take about 200 minutes to upload. When selecting a URL as opposed to a local file, does vSphere Client download it locally and then upload, or does it download the OVA directly to the server? My goal is to avoid waiting 3 1/2 hours for this to upload. If specifying a URL isn't any faster, are there any other methods that would allow me to deploy from the datacenter instead of my office? We don't have any Windows VM's installed on our cluster. So unfortunately I don't have a Windows machine with faster upload speed. 

If I had a dozen "Work" servers with just PHP-FPM (with other Nginx servers in front), is it possible to setup PHP to store user uploaded files on a different server? I'm looking to avoid syncing user files on each "Work" server. I want to keep user uploaded files on an isolated server. With files that need to be accessible to the public, they could be distributed through a CDN. I have several reasons for wanting to do this: 1) The sum file-size of all the uploaded files are several GB. 99% of them are jpg/png/pdf, but there are thousands of them. If I add another "Work" server, I'd rather not sync those files to another server. These "Work" servers should only contain the application code and do the work. 2) From a security standpoint, I don't want user uploaded files on these servers. So I basically want to avoid writing these files on the hard drives of the "Work" servers. What options do I have, if any? 

About six months ago we transitioned from an in-house Exchange 2003 server to a hosted Exchange 2010 service. For the most part this has worked well, but the providers OWA constantly times out. About 6/10 requests time out or more, and it's gotten to the point where OWA is just unusable. To give you an example: I'll login, read an email, choose reply and the window for replying gives me a request has timed out message. After a few attempts I'll get it to work and reply. After that I'll read another email and it'll timeout. I contacted the provider about this and they said it's a known issue with Exchange 2010, for all providers, they're working with Microsoft to correct the issue, and there is no ETA. To be clear this isn't a session issue. I don't have to login, it just says the request timed out and to try again. After a few attempts it does work. It's just extremely annoying. I've spent a litte time researching the problem and I can't find anything that would suggest it's a common issue. Exchange 2010 has been around for a while, so I would suspect that if it was a huge problem it would have been corrected by now. So is my provider full of crap, or is there really an issue that has yet to be corrected? If the issue does exist, is there any docs on it? 

I have a write-heavy application. The application is best compared to surveys - the customer creates custom questionares and this is saved to the database. Most of the requests are from their users submitting these forms. Later on our customers do complex reports and graphs on these submissions. Making sure our application server (PHP) and the web server (Nginx) scales is quite easy, the trouble is scaling the database server onto multiple servers. A lot of applications are more read heavy, so typically you'll have a master-slave replication setup where all writes go to a single master, but reads are distributed to the slaves. For us this doesn't work because we're doing writes most of the time. I've seen mention of a master-master setup, but this typically hits a snag with auto incremented primary keys. The solution is typically to have one server do odd numbers, and the other do evens. I want to avoid that. On some similar questions I've seen mention of the Tungsten Replicator and how it gives you a lot more flexibility with replication. Would this help me at all? What kind of benefits would this give me that MySQL's built in replication can not provide? There is also MySQL Cluster, but this typically hits a snag with very large databases and complex queries (joins). I need to be able to run complex reports, so this probably won't work for me. I'm looking for redundancy, automatic fail over, distributing requests, and data integrity. Are there other RDMS that provide better solutions that are suitable for the web? 

Is the server with PHP Linux or Windows based? For now I'll assume it's Linux based. Some of the advice below is valid regardless, you just have to take a slightly different approach. First thing to do is determine if the emails are even reaching your Exchange server. When you ping the domain, are you getting the IP address you expect? The outgoing email should have a "Return-Path" header. If the email is being rejected by Exchange, you should get a response to the address in "Return-Path" stating why the email was rejected. Typically with sendmail bounce backs end up in /var/mail. With PHP's mail function, there are a couple things to keep in mind. Are you setting a "From:" header? Is the address reachable? If you are setting headers (should at least set From:) make sure you don't have any trailing lines after your headers. Some mail server's don't like this. Last thing to check is the outgoing ip address in the email headers. Sometimes sendmail puts 127.0.0.1 instead of the public ip address. This has caused issues for me in the past. Since sendmail was difficult to configure, I just ended up using postfix. Another thing to consider is instead of sending mail from the local server on the PHP box, you could try configuring PHP to use your Exchange server to send emails. 

How does this work with logging? Does each node write to the same place? What about configuring static ip addresses? If machine A writes to the disk, does machine B pick it up? When he says "web node" does he mean just the web server? I'm assuming this means the web application as well (PHP/Perl), correct? Is this even a good idea (with mostly using RAM)? Can this same thing be done with iSCISI?