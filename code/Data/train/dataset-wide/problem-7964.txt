Form the set $S$ of all squares less than $p$. This has $O(\sqrt{p})$ elements, and writing them down takes $O(\sqrt{p} \log p)$ time. (You don't have to implement fast multiplication to do this; just compute the list of squares by successively adding odd numbers.) Let $T$ be the set of all integers expressible as the sum of two elements of $S$. This has $O(p)$ elements, and takes $O(p \log p)$ steps to write down. Sort $T$ and sort $p-T$. This is $O(p \log p)$ steps each. Find all duplicates between the lists $T$ and $p-T$; this takes $O(p)$ steps because they are already sorted. All in all, $O(p \log p)$ steps, the same size as the output. 

First of all, there is always the trivial factorization with $q=1$ and $r=p$. I'll discuss when more interesting ones exist, and how to find them. To make life simple, I'll deal with rational coefficients for most of the answer, and only address integrality at the end. To give a short answer first, there is a nontrivial factorization $p = q^2 r$ if and only if $GCD(p, \partial p/\partial x) \neq 1$. Write $p = p_1(x)^{1} p_2(x)^{2} \cdots p_k(x)^{k}$, where each $p_j$ has distinct (complex) roots and where the roots of $p_i$ and $p_j$ are disjoint. In other words, factor $p$ over $\mathbb{C}$ and group together roots that occur the same number of times. Clearly, a nontrivial expression of $p$ as $q^2 r$ is possible if and only if one of the $p_i$ is not $1$. I will explain the following points: (1) There is a good algorithm to compute the $p_i$ (much better than actually factoring $p$ over $\mathbb{Q}$!). (2) Each $p_i$ has rational coefficients. The key to part (1) is the observation $GCD(p, \partial p/\partial x) = \prod p_i^{i-1}$. To see this, notice that any root of the GCD must be a root of $p$. Moreover, if $r$ is a $k$-fold root of $p$ then it is a $(k-1)$-fold root of $\partial p/\partial x$. To compute the GCD, use Euclid's algorithm for polynomials. Note that, at every step, the polynomials have rational. coefficients, so the result does. Repeatedly using this method, one can compute: $$s_1 := p_1^{1} p_2^2 p_3^3 \cdots p_k^{k}$$ $$s_2 := \phantom{p_1^{1}} p_2^1 p_3^2 \cdots p_k^{k-1}$$ $$s_3 := \phantom{p_1^{1} p_2^1} p_3^1 \cdots p_k^{k-2}$$ up to $$s_k := \phantom{p_1^{1} p_2^1 p_3^1 \cdots} p_k$$ Then $p_k=s_k$, $p_{k-1} = s_{k-1}/p_k^2$, $p_{k-2} = s_{k-2}/p_{k-1}^2 p_k^3$ and so forth. If you want to do all of this with integer coeffients, then I suggest first solving the problem with rational coefficients. Once you find a factorization $p=q^2 r$, with $q(x)$ and $r(x)$ having rational coefficients, write $p=a p_0$, $q=b q_0$ and $r=c r_0$, with $p_0$, $q_0$ and $r_0$ primitive polynomials. Then Gauss's lemma tells you that $p_0 = q_0^2 r_0$, and you can always absorb the constant into the $r$. 

Here is an example of a map of chain complexes which can be realized as $du+vd$ but not as $du+ud$. Let $C$ and $D$ both be the chain complex $$\cdots 0 \to \mathbb{Z}/p^2 \to \mathbb{Z}/p^2 \to 0 \to \cdots$$ where the nontrivial map is multiplication by $p$. Map $C$ to $D$ by multiplication by $p$ in the first nontrivial degree, and by zero in the other nontrivial degree. This is $du+vd$, where $u$ is $1$ and $v$ is $0$ (in the only nontrivial degree). On the other hand, this map cannot be written as $du+ud$. If we had such a representation, then $u$ would be multiplication by $a$ for some $a \in \mathbb{Z}/p^2$. The two vertical maps would then both be $pa$. In particular, it is impossible that one would be zero and the other not. If we consider these complexes as objects in the derived category of $(\mathbb{Z}/p^2)$-modules, they are complexes of projective objects. So this is an example of a map of complexes which induces zero maps on cohomology but is not zero in the derived category. What happens if we pass to a quotient category where maps like this are zero? I have no idea! Does anyone? 

I wanted to add a simple combinatorial proof that the coefficient of $x^p y^q$ is dependent only on $p+q$. Given a Dyck path of length $2n$, let $q$ be the number of returns to $0$ and let the initial segment be $0 1 2 3 \cdots (p-1) p (p-1)$. I will introduce an operation which sends a path of type $(p,q)$, with $q \geq 2$, to one of type $(p+1, q-1)$. So, take a Dyck path with $q \geq 2$. Write it as a matching parentheses sequence; we can decompose it as $$( D_1 ) ( D_2 ) ( D_3 ) \cdots ( D_q )$$ where each $D_i$ is, itself, a matching parentheses sequence. We map it to $$((D_1)D_2) (D_3) \cdots (D_q)$$ It is easy to see that this map is invertible for $p \geq 2$. 

I think Hunter and Greg's answers make it hard to see the forest for the trees. Let X be a compact Riem. surface of genus >= g. Let Y be the universal cover of X equipped with the complex structure pulled back from X. As a complex manifold, Y is isomorphic to the upper half plane, and the deck transformations form a subgroup Gamma of PSL_2(R). There will be characters chi of Gamma for which there are nonzero functions f on Y such that f(gz) = chi(g) f(z). For chi ample enough (not defined here), we will be able to choose functions (f_1, f_2, f_3) such that z --> (f_1(z) : f_2(z) : f_3(z)) gives an immersion X --> P^2. All of this works in any genus. The technical issue is that this map is an immersion, not an injection, meaning that the image can pass through itself. One can either decide to live with this, or work with maps to P^3 instead. Most books that I have seen don't lift all the way to the universal cover of X. Instead, they take the covering of X which corresponds to the commutator subgroup of pi_1(X). This can be motivated in a particular nice way in terms of the Jacobian. This is a complex manifold with the topological structure of a 2g dimensional torus. There is a map X --> J, so that the map pi_1(X) --> pi_1(J) is precisely the map from pi_1(X) to its abelianization. People then work with the universal cover of J, and the preimage of X inside it. This has three advantages: the universal cover of J is C^g, not the upper half plane; the group of Deck transformations is Z^{2g}, not the fundamental group of a surface, and the action on C^g is by traslations, not Mobius transformations. The functions which transform by characters, in this setting, are called Theta functions*, and they are given by explicit Fourier series. *This is a slight lie. Theta functions come from a certain central extension of the group of Deck transformations. It is certain ratios of Theta functions that will transform by characters as sketched above. The P function itself, for example, is a ratio of four Theta functions. In the higher genus case, in my limited reading, I haven't seen names for these ratios, only for the Theta functions. 

$\def\RR{\mathbb{R}}$A brute force approach shows that there are no other $C^2$ solutions. Let $F: \RR^n \to \RR^n$ have orthogonal Jacobian everywhere. We will show that the Hessian of $F$ vanishes everywhere, so $F$ is linear. It is enough to show that Hessian vanishes at $0$, since there is nothing special about $0$. Translating and rotating our coordinates, we may assume that $F(0) =0$ and the Jacobian at $0$ is the identity. So, writing the components of $F$ as $(F_1, \ldots, F_n)$, we have $$F_j(x_1, \ldots, x_n) = x_j + \sum_{a,b} Q^j_{ab} x_a x_b + (\mbox{higher order terms}).$$ Here $Q^1$, $Q^2$, ..., $Q^n$ are each symmetric $n \times n$ matrices. Our goal is to show $Q^j=0$. Up to linear terms, the $(i,j)$ entry in the Jacobian is $\delta_i^j + 2 \sum_k Q^j_{ik} x_k$. Writing down the condition that the $j$-th column has length $1$, up to linear terms, gives $1+2 \sum Q^j_{jk} x_k = 1$. So $Q^j_{jk}=0$ and, by the symmetry of $Q^j$, we also have $Q^j_{kj}=0$. Let $i \neq j$. Writing down the condition that the $i$-th and $j$-th column are orthogonal, up to linear order, gives $2 \sum_k Q^i_{jk} x_k + 2 \sum_k Q^j_{ik} x_k=0$, so $Q^j_{ik} = - Q^i_{jk}$ whenever $i \neq j$. If $(i,j,k)$ are all distinct, we have $Q^i_{jk} = - Q^j_{ik} = Q^k_{ij} = - Q^i_{kj} = - Q^i_{jk}$. So $Q^i_{jk}=0$. If $j$ and $k$ are distinct, we have $Q^j_{kk} = Q^k_{jk}=0$. In all cases, we have shown the entries of $Q$ are $0$. 

What it means for a covering of a sphere to be branched: Let $f:X \to Y$ be a map of Riemann surfaces. We are particularly interested in the case that $Y$ is $\mathbb{CP}^1$; in this case, $Y$ has the topology of a sphere. At most points $y$ in $Y$, there will be a neighborhood $V$ of $y$ so that $f^{-1}(V)$ is just a union of $n$ disjoint copies of $U$, each mapping isomorphically to $V$. These are the points where there is no branching. At a few points of $y$, something different will happen. Let $x$ be a preimage of $y$, let $V$ be a small neighborhood of $y$ and let $U$ be the connected component of $f^{-1}(V)$ containing $x$. At these points, the map $f$ looks like $t \mapsto t^e$, as a map from the unit disc in $\mathbb{C}$ to itself. This is called branching. The generic situation is that, at finitely many points of $Y$, one of the preimages is branched with $e=2$ and the other $n-2$ preimages are unbranched. Algebraically, if $t$ is a local coordinate on $X$, then we have branching where $\partial f/\partial t$ vanishes. Even if we can't explicitly write $f$ as a function of $t$, if we can find a polynomial relation $P(f,t)=0$, then we have $(\partial P/\partial f)(\partial f/\partial t) = \partial P/\partial t$, so branching will occur when $\partial P/\partial t=0$. The relation between branched covers and the symmetric group: Let $f: X \to \mathbb{CP}^1$ be a branched cover. Let $R \subset \mathbb{CP}^1$ be the points over which branching occurs. Then $f^{-1}(\mathbb{CP}^1 \setminus R) \to \mathbb{CP}^1 \setminus R$ is a cover, in the sense of algebraic topology. As you probably know, connected covers of a space $U$ are classified by subgroups of $\pi_1(U)$. In particular, degree $n$ covers are classified by index $n$ subgroups. I like to recast this and say that degree $n$ connected covers of $U$ are classified by transitive actions of $\pi_1(U)$ on an $n$-element set. This has the advantage that, more generally, we can say that degree $n$ covers of $U$ are classified by actions of $\pi_1(U)$ on an $n$-element set. Now, in this case, $\pi_1(\mathbb{CP}^1 \setminus R)$ is isomorphic to the group generated by $R$, modulo the relation $\prod{r \in R} [r]=1$. You should be warned that this isomorphism depends on some choices. First of all, we need to choose a base point $y$ in $\mathbb{CP}^1 \setminus R$! Even once we've done that, we need to choose loops based at $y$, circling each of the elements of $R$, and disjoint from each other away from $y$. These will then be the classes $[r]$. The order that the product above is taken is related to the circular order at which these loops come in to $y$. So, to covers of $\mathbb{CP}^1 \setminus R$ correspond to maps from this group to $S_n$. To give such a map, we choose an element $b(r)$ of $S_n$ for each $r$ in $R$; these must obey $\prod_{r \in R} b(r)=1$. (I am being very sloppy about when two such maps give isomorphic covers, and, indeed, what it means to say two covers are isomorphic.) The relation between the geometry of the cover, and the map $b(r)$ is the following: If the permutation $b(r)$ has cycles of lengths $e_1$, $e_2$, ..., $e_k$, then $f^{-1}(r)$ contains $k$ points, which are branched with degrees $e_1$, $e_2$, ..., $e_k$. Useful facts to know: The cover is connected if and only if the action of the $b(r)$ on $[n]$ is transitive. The genus of $X$ is given by, the Riemmann-Hurwitz formula: $$2g-2 = -2n+\sum_{r \in R} (n-\#\mbox{cycles of $r$}).$$ It is very difficult to obtain an explicit equation for $X$ from the data of $R$ and $b:R \to S_n$. 

The function you want is a modular function. The universal cover of C \ {0,1} is the upper half plane; a fundamental domain is { z : 0 < Re(z) < 1, |z-1/2| > 1/2 }. This is also a fundamental domain for the action of \Gamma_0(2) on the upper halfplane, where \Gamma_0(2) is the group of integer matrices whose lower left hand entry is even. There is a standard construction of a modular function which has this symmetry; but I'm forgetting the terminology. Scott will probably come along soon and fill in the details I'm missing. A good reference for this sort of thing is Conformal Mapping, by Zeev Nehari. 

I just did the computation directly and got Mazur's result (details below). I am not sure how you are trying to use the result you cite. Your result describes which numbers occur as traces of Frobenius on elliptic curves defined over $\mathbb{F}_{3^{12}}$, but doesn't single out which of those curves will be obtained from curves definable over $\mathbb{F}_3$. So the numbers $1458$, $658$ and $-1358$ do indeed match the criteria of your theorem. The first one is $2 \times \sqrt{3^{12}}$, case 2, and the other two are not divisible by $3$, case $1$. Of course there are tons of other numbers which match the criteria of your theorem; they will be traces of Frobenius on elliptic curves defined over $\mathbb{F}_{3^{12}}$ that don't descend to $\mathbb{F}_3$. The way I will do the computation is to first list all the curves definable over $\mathbb{F}_3$, and then work out the trace of $3^{12}$-th power Frobenius. Let $E$ be an elliptic curve defined over $\mathbb{F}_3$. Let $a$ be the trace of $3$rd power Frobenius. By the result you cite, $a$ is one of $\{ \pm 3, \pm 2, \pm 1, 0 \}$. As yet, I haven't used the extension field $\mathbb{F}_{3^{12}}$ anywhere. Denote the eigenvalues of $3$rd power Frobenius by $\lambda_{\pm}$. They are the roots of $$x^2 - ax + 3 =0.$$ Using the values of $a$ above, I get that they are $$\pm \frac{-3 \pm \sqrt{-3}}{2},\ \pm (-1 \pm \sqrt{-2}),\ \pm \frac{-1 \pm \sqrt{-11}}{2},\ \pm \sqrt{-3}.$$ In each case, the inner $\pm$ switches $\lambda_{+}$ and $\lambda_{-}$ while preserving the value of $a$, and the outer $\pm$ negates $a$. If $3$rd power Frobenius has eigenvalues $\lambda_{+}$ and $\lambda_{-}$ then $3^{12}$ Frobenius has eigenvalues $\lambda_+^{12}$ and $\lambda_-^{12}$, and hence trace $\lambda_{+}^{12} + \lambda_{-}^{12}$. Applying this to each of the terms above I get $$\begin{matrix} 729+729 &= 1458 & (329 + 460 \sqrt{-2}) + (329 - 460 \sqrt{-2}) &= 658 \\ (-679+80 \sqrt{-11}) + (-679 - 80 \sqrt{-1}) &= -1358 & 729+729 &= 1458 \end{matrix}.$$ In summary, the term $1458$ arises from the elliptic curves where $3$rd power Frobenius has trace $\pm 3$ or $0$, the term $658$ arises from the elliptic curves where $3$rd power Frobenius has trace $\pm 2$ and the term $-1358$ arises from the elliptic curves where $3$rd power Frobenius has trace $\pm 1$.