I didn't read the article fully, but I guess it is a basic stuff in commutative algebra: The quotient $\mathbb{T} / \mathfrak{p}$ being an integral extension of $R$, after base change, $\mathbb{T}\otimes_R K / \mathcal{P}$ is a field extension of $K$. Thus $\mathcal{P}$ is a prime ideal. If $\mathcal{P}$ were not minimal, $\mathfrak{p} = \mathcal{P}\cap \mathbb{T}$ wouldn't be minimal either. 

Lift the idempotents $e^1, \cdots, e^r$ to idempotents $d^1, \cdots, d^r\in \hat A$, which is possible by the $t$-adic completeness. By modifying $d'_1=d_1,\; d'_2=(1-d'_1)d_2(1-d'_1),\; d'_3=(1-d'_1)(1-d'_2)d_3(1-d'_1)(1-d'_2)$, etc, we can make $d_id_j = 0$ for $i\neq j$. Define as before $\hat A^{ji}= d_j\hat Ad_i$ and $\hat M^i = d_i\hat M$. Then 

Proof. By replacing $A$ (resp. $B$) with its image in $\mathrm{End}_{k[t]}(M)$ (resp. $\mathrm{End}_{k[t]}(M)[t^{-1}]$), we regard it as a $k[t]$-subalgebra. First, we study the central fibers. We denote $\bar M = M_0$ and $\bar A=$ the image of $A$ in $\mathrm{End}_k(\bar M)$ 

In recollection, we've seen that $\bar A = \bigoplus_{j\le i}\bar A^{ji}$ and $\bar A^{ji} = \mathrm{End}_k(\bar M^i, \bar M^j)$. Next, we lift the results to the $t$-adic completions $\hat A, \hat B$ and $\hat M$. We regard $\hat A\subseteq \mathrm{End}_{k[[t]]}(\hat M)$ and $\hat B\subseteq \mathrm{End}_{k((t))}(\hat M[t^{-1}])=\mathrm{End}_{k[[t]]}(\hat M)[t^{-1}]$. 

We claim that the extension hypothesis on $M_0$ implies $b_{ji} = 0$ for $j < i$. As we already know $b_{ji} \le a_{ji} = 0$, suppose that $b_{ji} < 0$. The hypothesis says that the $k$-algebra homomorphism $\hat A\to \mathrm{End}_k(\bar M)$ factors through $\hat A\to B_0 \cong \hat B/t\hat B$. In particular, the ideal $t\hat B\cap \hat A$ falls into the kernel of the former. Since now $b_{ji} < 0$ and $a_{ji}=0$, we see that $\mathrm{Hom}_{k[[t]]}(\hat M^i, \hat M^j)\subseteq t\hat B\cap \hat A$ sends to $0$ via the reduction map $\mathrm{End}_{k[[t]]}(\hat M)\to \mathrm{End}_{k[[t]]}(\hat M) \pmod{t} \cong \mathrm{End}_k(\bar M)$, absurd. Now we have seen $b_{ji} \ge 0$ for all $1\le i, j\le r$, which means $\hat B\subseteq \mathrm{End}_{k[[t]]}(\hat M)$. 

Given any morphism of schemes $f: X \to Y$ we have the adjunction $(f^*, f_*, \epsilon_f, \eta_f)$: $$ f^*: D_c(Y, \mathbf{C})\to D_c(X, \mathbf{C}),\; f_*: D_c(X, \mathbf{C})\to D_c(Y, \mathbf{C}) $$ $$ \epsilon_f : \mathrm{id} \to f_*f^*, \; \eta_f : f^*f_* \to \mathrm{id} $$ Then, given any two morphisms $X\xrightarrow{f}Y\xrightarrow{g} Z$, we then have $(g_*\epsilon_fg^*)\epsilon_g = \epsilon_{gf}$, as indicated below \begin{CD} \mathrm{id}@>\epsilon_{gf}>> (gf)_*(gf)^* \\ @V\epsilon_{g}VV @| \\ g_*g^*@>g_*\epsilon_fg^*>> g_*f_*f^*g^* \end{CD} Given any morphism of schemes $f: X \to Y$ we have the adjunction $(f_!, f^!, \sigma_f, \tau_f)$: $$ f_!: D_c(X, \mathbf{C})\to D_c(Y, \mathbf{C}),\; f^!: D_c(Y, \mathbf{C})\to D_c(X, \mathbf{C}) $$ $$ \sigma_f : \mathrm{id} \to f^!f_!, \; \tau_f : f_!f^! \to \mathrm{id} $$ Then, given any two morphisms $X\xrightarrow{f}Y\xrightarrow{g} Z$, we then have $\tau_g(g_!\tau_fg^!) = \tau_{gf}$, as indicated below \begin{CD} g_!f_!f^!g^!@>g_!\tau_{f}g^!>> f_!f^! \\ @| @V\tau_{f}VV \\ (gf)_!(gf)^!@>\tau_{gf}>> \mathrm{id} \end{CD} 

We write $z = e^{2\pi is}$ for $s \in \mathbf{R}$. Let $\gamma$ be the Euler constant so that $H(n) = \log n + \gamma + o(1)$. We claim that $$S = \frac{Ne^{2\pi is(\log N + \gamma)}}{2\pi i s + 1} + o(N).$$ Put $S_N = N^{-1}\sum_{n=1}^N e^{2\pi i sH(n)}$ and $S'_N = N^{-1}\sum_{n=1}^N e^{2\pi i s\log n}$. Suppose we have managed to show that $S'_N = \frac{N^{2\pi is}}{2\pi i s + 1} + o(1)$. Then since $$|e^{2\pi is \gamma}S_N'-S_N| \le N^{-1}\sum_{n=1}^N\left|e^{2\pi is (\log n + \gamma)}(1 - e^{2\pi i s(H(n)-\log n - \gamma)})\right| $$ Clearly, the term $1 - e^{2\pi i s(H(n)-\log n - \gamma)}$ is arbitrarily small when $n\to \infty$. Thus $$\lim_{N\to \infty}|e^{2\pi is \gamma}S_N'-S_N| = 0,$$ and the claim will follow. It remains then to show that $$S'_N = \frac{N^{2\pi is}}{2\pi i s + 1} + o(1). $$ We shall calculate the limit $$ \lim_{N\to\infty}\frac{S'_N}{N^{2\pi i s}} = \lim_{N\to\infty}N^{-1}\sum_{n=1}^N \left(\frac{n}{N}\right)^{2\pi i s} $$ For any $\epsilon > 0$, we choose a continuous function $\varphi_{\epsilon}(x)$ on $[0, 1]$ such that $0\le \varphi_{\epsilon} \le 1$, $\varphi_{\epsilon}(0) = 0$ and $\varphi_{\epsilon}\big|_{[\epsilon, 1]} = 1$. Then we have the cut off limit $$ \lim_{\epsilon \searrow 0}\lim_{N\to \infty} N^{-1}\sum_{n=1}^N \left(\frac{n}{N}\right)^{2\pi i s}\varphi_{\epsilon}\left(\frac nN\right) = \lim_{\epsilon \searrow 0}\int^1_0x^{2\pi is}\varphi_{\epsilon}(x)dx $$ By dominant convergence, $$\lim_{\epsilon \searrow 0}\int^1_0x^{2\pi is}\varphi_{\epsilon}(x)dx = \int^1_0x^{2\pi is} dx = \frac{1}{2\pi is + 1}.$$ Now consider the difference between the orginal limit and the cut off limit. The value $|1 - \varphi_{\epsilon}\left(\frac nN\right)|$ is $0$ when $n/N \ge \epsilon$ and is $\le 1$ in general, so $$ \lim_{\epsilon \searrow 0}\lim_{N\to \infty} N^{-1}\sum_{n=1}^N \left|\left(\frac{n}{N}\right)^{2\pi i s}\left(1 - \varphi_{\epsilon}\left(\frac nN\right) \right)\right| \le \lim_{\epsilon \searrow 0}\lim_{N\to \infty} N^{-1}\sum_{\substack{n=1 \\ n/N < \epsilon}}^N 1\le \lim_{\epsilon \searrow 0} \epsilon = 0, $$ Therefore, the two limits agree, giving us $$ \lim_{N\to\infty}N^{-1}\sum_{n=1}^N \left(\frac{n}{N}\right)^{2\pi i s} = \lim_{\epsilon \searrow 0}\lim_{N\to \infty} N^{-1}\sum_{n=1}^N \left(\frac{n}{N}\right)^{2\pi i s}\varphi_{\epsilon}\left(\frac nN\right) = \frac{1}{2\pi is + 1}. $$ We have now proven $\lim_{N\to\infty}S'_N/N^{2\pi i s} = (2\pi is + 1)^{-1} $, whence $$S'_N = \frac{N^{2\pi i s}}{2\pi is + 1} + o(1)$$ as desired. 

$\require{AMScd}$ After the struggle of a whole day due to my unfamiliarity with the category theory, I found the answer. The commutativity is due essentially to the following facts: 

We've done, beacuse $B$, considered as subalgebra of $\mathrm{End}_{k[[t]]}(\hat M)[t^{-1}]$, is then contained in $\mathrm{End}_{k[[t]]}(\hat M)\cap \mathrm{End}_{k[t]}(M)[t^{-1}] = \mathrm{End}_{k[t]}(M)$, which extends $M$ into a $B$-module. Q.E.D. I believe that the strengthened hypothesis is essential. We notice also that the extension of $M_0$ into a $B_0$-module may not be unique. I guess the uniqueness corresponds to the case where $b_{ji}=0$ (minimum possible) for those $b_{ji}\neq a_{ji}$. 

The first one is obvious, while the second one is a sheaf-theoretic version of the Fubini theorem. Now we turn to the diagramme in question \begin{CD} Y' @>\tilde g>> Y \\ @Vf'VV @VfVV\\ X' @>g>> X \end{CD} where $f$ is proper and $g$ is smooth and equidimensional. Suppose we are given two objects $A, B\in D_c(X, \mathbf{C})$ and a morphism $\varphi\in \mathrm{Hom}(f^*A, f^!B)\cong \mathrm{Hom}(A, f_*f^!B)$. Form the following diagramme \begin{CD} g^* A @>g^*\epsilon_f>> g^*f_*f^* A @>g^*f_*\varphi>> g^*f_*f^! B @>g^*\tau_f>> g^* B \\ @V\epsilon_{f'}g^*VV @V\mathrm{BC}VV @V\mathrm{BC}VV @A\tau_{f'}g^*AA \\ f'_*{f'}^*g^*A @= f'_*\tilde g^*f^*A @>f'_*\tilde g^*\varphi>> f'_*\tilde g^*f^!B @= f'_*{f'}^!g^*B \end{CD} This diagramme is commutative: 

This is not true even if $A$ and $B$ are assumed to be commutative, for some trivial reasons. For example, let $A = k[t, s]/(s)(s-t)(s-2t)$, which represents three lines on a plane concurrent at the origin, and let $B = k[t, s]/(s)(s-t)\times k[t, s]/(s-2t)$, which is a partial resolution of $A$. There is an obvious (diagonal) morphism $A\to B$, which is injective and becomes bijective after inverting $t$. Set $C = k[t, s]/(s-t)(s-2t)$. We got a natural surjection $A\to C$ as well. Now put $M = C$ as an $A$-module. We have then $A_0 = A/tA\cong k[s]/(s^3)$, $B_0 = B/tB = k[s]/(s^2)\times k[s]/(s)$ and $M_0 = M/tM = k[s]/(s^2)$. Now the $A_0$-module $M_0$ extends uniquely into a $B_0$-module, which must be supported on the first factor of $B_0$, namely $k[s]/(s^2)$. However, the $A$-module $M$ does not extend to a $B$-module, since otherwise $M = (0, 1)M \oplus (1, 0)M$ would be decomposible, which would imply $M$ was decomposible as $A$-module, and then as $C$-module, contradicting the fact that $C$ is connected. I guess one should at least impose some connectivity assumption on the generic fibers. response to the comment (edited 16.8.2017) I made a serious mistake in my previous response: $M_0$ need not be irreducible. I doubt that the condition $\mathrm{End}_{A_0}(M_0)=k$ is enough. I address the problem in some special cases here by strengthening the hypothesis on endomorphisms: 

Now, if we set $A = \mathbf{C}$ and $B = \omega_X[-k]$ in $D_c(X, \mathbf{C})$ for $k\in \mathbf{Z}$, then every homology class $\alpha\in H_k(Y)\cong \mathrm{Hom}_{D_c(Y)}(f^*A, f^! B)$ corresponds to a morphism $\varphi_{\alpha}: f^*A \to f^! B$. Then the composite $$(g^*\tau_f)(g^*f_*\varphi_{\alpha})(g^*\epsilon_f): g^*A \to g^*B$$ corresponds exactly to the class $g^*f_*\alpha\in H_{k+2d}(X')$, whereas the composite $$ (\tau_{f'}g^*)(f'_*\tilde g^*\varphi_{\alpha})(\epsilon_{f'}g^*): g^*A \to g^*B $$ corresponds to the class $f'_*\tilde g^*\alpha\in H_{k+2d}(X')$. The commutativity of the above 8-term diagramme applying to $\varphi = \varphi_{\alpha}$ then tells us that $$ (g^*\tau_f)(g^*f_*\varphi_{\alpha})(g^*\epsilon_f) = (\tau_{f'}g^*)(f'_*\tilde g^*\varphi_{\alpha})(\epsilon_{f'}g^*) $$ and consequently $g^*f_*\alpha = f'_*\tilde g^*\alpha$. Thus $g^*f_* = f'_*\tilde g^*:H_*(Y)\to H_*(X')$. 

In the book [N. Chriss & V. Ginzburg, Representation theory and complex geometry, 8.3.34] , this is shown in the case where $g$ is locally a trivial fibration, by reducing it to the commutativity of the following diagramme of derived functors \begin{CD} f_*f^! @>>> \mathrm{id}_X @>>> g_*g^* \\ @VVV @. @AAA \\ f_*\tilde g_*\tilde g^*f^! @. = @. g_* f'_*{f'}^! g^* \end{CD} in which all the morphisms are adjunction morphisms except for the base change morphism $\tilde g^*f^! \cong {f'}^! g^*$ in the bottom line, whose definition can be found in [SGA4, Exposé 18, 3.1.14.2]. One gets the result by apply the diagramme to $\omega_X$ and then take global sections. The commutativity of the diagramme above can be easily checked in the case where $g: X'\to X$ is locally a trivial fibration. While I don't know how to do it if $g$ is only assumed to be smooth, I still suspect the commutativity to remain true. Let me also add that there is such an equality $f'_*\tilde g^* = g^*f_*: A_*(Y)\to A_*(X')$ for Chow groups and for $f$ proper and $g$ flat, see for example [Fulton, Intersection theory, Prop. 1.7]. 

Similarly, write $\hat B^{ji} = d_j\hat Bd_i$. For any $1\le i , j\le r$, we proceed as in 7., so that $\hat B^{ji} = t^{b_{ji}}\mathrm{Hom}_{k[[t]]}(\hat M^i, \hat M^j)$ for some $b_{ji} \in \mathbb{Z}\cup \{+\infty\}$ and $b_{ji} \le a_{ji}$. The finiteness of $\hat B$ over $k[[t]]$ gives some bounds on these exponents: 

Take a Jordan-Hölder filtration $0 = F_0\subseteq \cdots\subseteq F_r = \bar M$. Since $F_1$ is irreducible, it acquires an induced $\bar A/\mathrm{Rad}(\bar A)$-module structure. Let $\bar e\in \bar A/\mathrm{Rad}(\bar A)$ be the idempotent corresponding to $F_1$. We lift it to an idempotent $e_1\in \bar A$. We claim that $e_1\bar M\subseteq F_1$ (thus $e_1\bar M=F_1$ by irreducibility). Suppose $e_1\bar M\subseteq F_i$ and $e_1\bar M\not\subseteq F_{i-1}$. Then $F_i/F_{i-1}$ considered as irreducible $\bar A/\mathrm{Rad}(\bar A)$-module must correspond to the idempotent $\bar e$. Thus $F_i/F_{i-1}\cong F_1$. The composite $F_i\to F_i/F_{i-1}\cong F_1\subseteq F_i$ gives an endomorphism of $F_i$, which by hypothesis is equal to a scalar. This implies $i=1$. We have $(1-e_1)F_i \cong F_i/ F_1$ and it acquires a $(1-e_1)\bar A(1-e_1)$-module structure. On the module $\bar M/F_1$ there is an induced Jordan-Hölder filtration $0 = (1-e_1)F_1 \subseteq \cdots \subseteq(1-e_1)F_r = (1-e_1)\bar M$. Repeating 2. and 3., with the ring $(1-e_1)\bar A(1-e_1)$, the module $(1-e_1)\bar M$ and the new filtration, we get idempotents $e_1, ..., e_r$ such that $e_ie_j = 0$ for $i\neq j$, and that $e_i\bar M \subseteq F_i$, $e_i\bar M \cong F_i/F_{i-1}$ via the canonical projection. Consequently, we have decomposition $\bar M = \bigoplus_j e_j \bar M$ and $F_i = \bigoplus_{j\le i} e_j\bar M$. We denote $\bar M^i = e_i\bar M$ and $\bar A^{ji} = e_j\bar Ae_i$. The algebra $\bar A$ decomposes into subspaces $\bar A^{ji}\subseteq \mathrm{Hom_k}(\bar M^i, \bar M^j)$. Let's show that $\bar A$ is the "parabolic subalgebra" of $\mathrm{End}_k(\bar M)$ with respect to the filtration $(F_i)_i$.