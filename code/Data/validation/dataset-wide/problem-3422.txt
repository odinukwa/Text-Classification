Expanding on jmbejara's answer and your question about integration, there are really three steps here: 

If the underlying stochastic processes are not Itō diffusions, then I'm not sure what the best reference is. The most common such case I've seen (and that I use myself) is the case of discretely many exogenous states, where if we are currently in state $s$ there is some constant hazard rate $\lambda_{s,s'}$ of a switch to state $s'$. Fortunately, this is a pretty simple case in practice: one can just modify the HJB equation to account for the flow probability of switching from $V(\cdot,s)$ to $V(\cdot,s')$. (You can see this, for instance, in equations (1)-(5) in this Acemoglu and Akcigit paper. Conceptually it's no different from setting up the HJB equation when we have an Itō diffusion as the driving process, except that it's simpler because we just get a system of linear equations and we don't need to think about Itō's lemma, etc.) Of course, maybe there is a good textbook reference for this too - but unlike the potentially much more complicated cases involving stochastic calculus, this is straightforward enough that a text has never seemed necessary to me. 

It is very important here to note that there are multiple, mutually inconsistent, possibilities for how to define a substitute/complement. One way is to say that $x$ and $y$ are complements if an increase in $y$ raises the marginal utility of $x$ (or, given symmetry of mixed partials, vice versa): $$\frac{\partial^2 U}{\partial x\partial y}>0\tag{1}$$This is the suggestion in foobar's answer. Another way is to say that $x$ and $y$ are complements if a decrease in the price of $y$ raises the Hicksian (aka compensated) demand for $x$. Since Hicksian demand is the derivative of the cost (aka expenditure) function by Shephard's lemma, this can also be expressed as a condition on mixed partials: $$\frac{\partial^2 C}{\partial p_x\partial p_y}<0\tag{2}$$ This is the suggestion in snoram's comment, and it is the notion more commonly taught in micro classes. These definitions are not equivalent! Indeed, in any case with only two goods, those two goods must be substitutes according to (2), regardless of whether the cross-partial of $U$ in (1) is positive or not. One can give fruitful labels to these concepts (though these labels are more common in the case of production rather than utility functions). Following Hicks, we can call complements by definition (1) q-complements: if $x$ and $y$ are q-complements, an increase in the quantity of $y$ leads to an increase in the marginal value of $x$. Meanwhile, we can call complements by definition (2) p-complements: if $x$ and $y$ are p-complements, a decrease in the price of $y$ leads to an increase in the demand for $x$. See, for instance, Seidman (1989) for a brief overview. Both concepts are useful in different situations - it depends on what you're interested in! 

In the Arrow-Debreu model, households are endowed with some commodities, producers can use feasible production plans to transform commodities, and households ultimately consume commodities - which they choose optimally given their preferences subject to budget constraints. These commodities can include (potentially time and state-contingent) labor services provided by households. In this framework, provision of labor can simply be viewed as a form of negative consumption, which decreases utility but provides earnings that can be spent elsewhere. Indeed, the original Arrow-Debreu paper mentions this interpretation several times. For instance, on page 268 when they describe households in the model (which they call "consumption units"): 

Although I'm not sure that Piketty ever directly discusses the exact definition of $r$, he does make it clear indirectly. On page 52 of the hardcover English-language edition of his book, Piketty declares his "first fundamental law of capitalism": 

It all depends on whether you treat the budget constraint as an equality or inequality constraint. These are two different problems, with two different solutions in this case. One version of the problem (rewriting the objective in the form suggested by denesp, and dropping the constant, for clarity) is \begin{align} \max~&-4(x-4.5)^2 -2(y-1.5)^2\\\text{s.t. }&5x+7y=40 \end{align} With this equality constraint, the optimum is $(x,y)=(4.78,2.29)$ as you found using the method of Lagrange multipliers and Wolfram alpha. It's true that you would prefer consuming less and staying at the bliss point, but if we assume that the budget constraint is an equality then you aren't allowed to consume less. Another version of the problem is \begin{align} \max~&-4(x-4.5)^2 -2(y-1.5)^2\\\text{s.t. }&5x+7y\leq40 \end{align} with an inequality in the budget constraint. Here, as you point out, it's clear that the optimum is $(x,y)=(4.5,1.5)$, because that's the consumption profile that globally maximizes the utility function (and it obeys the budget inequality). Assuming that the budget constraint is an inequality is usually more appropriate (presuming that you can always "throw away" extra wealth). When solving constrained optimization problems where some of the constraints are inequalities, we need a generalization of the basic method of Lagrange multipliers called the Karesh-Kuhn-Tucker (KKT) conditions, which has probably not been covered in your course. You can read about this in more detail in the linked wikipedia article, but the basic idea is simple: we can still set up the Lagrangian, where we write the constraint as $g(x,y)=5x+7x-40\leq 0$ and then subtract $\lambda g(x,y)$ from the objective: $$\mathcal{L} = -4(x-4.5)^2 -2(y-1.5)^2 - \lambda(5x+7y-40)$$ We can then equate the partial derivatives to 0 ($\partial\mathcal{L}/\partial x = 0$ and $\partial\mathcal{L}/\partial y=0$) to get two conditions \begin{align} \frac{\partial\mathcal{L}}{\partial x}&=0 \Longleftrightarrow 8(x-4.5)=-5\lambda\tag{1}\\ \frac{\partial\mathcal{L}}{\partial y}&=0 \Longleftrightarrow 4(y-1.5)=-7\lambda\tag{2} \end{align} The question, then, is how to pin down $\lambda$. You're probably used to finding $\lambda$ by seeing which value causes the budget constraint to hold with equality. In this case, however, that implies $\lambda<0$. This is not allowed for an inequality constraint under the KKT conditions, which require $\lambda\geq 0$.** Since $\lambda$ turns out to be the marginal utility of wealth, this constraint is tantamount to saying that more wealth (which relaxes the inequality) shouldn't hurt us. The KKT conditions also have a requirement called complementary slackness, which states that either the inequality must bind (holding with equality) at the optimum, or else $\lambda$ must be 0. (Since $\lambda$ measures the "cost" of the constraint, this is logical: if the constraint isn't binding, then the cost must be 0, and it shouldn't be affecting your local optimization problem.) We already saw that if the budget constraint holds with equality, we get $\lambda<0$, which isn't allowed, so complementary slackness implies our only remaining option is $\lambda=0$. Plugging this into (1) and (2) above, we get $(x,y) = (4.5,1.5)$, which is the solution you already found intuitively. Usually, there is no need in introductory micro to use the full KKT conditions, because we work with utility functions that are monotonic, where you'll always want to exhaust your budget constraint. Simple concave quadratic utility with an interior bliss point, like in this case, is an exception where we need a very simple case of the KKT conditions to do the optimization properly.