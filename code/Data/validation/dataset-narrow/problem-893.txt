This way bat,com,exe,dll,vbs are gone. But, since there's OS's that treats extensionless files like executables, it came to my mind that these should be blocked also. How to have that/what would be regexp to match these files along with known executables? 

During update process, I was prompted where to install GRUB boot loader - on sda, sdb, md's or all together? What choice is correct? 

My () over some (variable) period of time comes to unusual system resources utilization. I'm positive that I don't have that amount of traffic and dos/ddos are pretty much out of list because no web server restart can do anything to dos/ddos. What are the symptoms? System load ( command) shows - - . On 8 core machine, usual load never goes above unless something other happens, often it is - . command proves is the one to blame. Why I'm making big deal about tolerable system load? It seems like disk I/O is also increased (temperature 2-3 celsius up), I would rather to avoid this bacause both hdd's are several years old. And I don't know where is this going. Configuration file (large comments stripped): 

I'm not after services that could provide me with fancy fine-grained control like , I don't need per user/domain control, I only want to: 

From link you provided, it looks like you're being hacked by WSO malware. You may attempt to remove malware with tools like Linux Malware Detect or ClamAV or ClamAV with extended, unofficial signatures, and you will have more or less success, but only way to be certain the malware is gone is to wipe everything and restore from backup. I hope you have backup. You may want to read this very informative Q&a about your problem - how to deal with compromised server. Good luck. 

Generally speaking, headers are first to forge by spammers. You might have more than one headers in the received messages. At least one of them should contain correct . What you probably want is rejecting forged messages. Aside from setting up to mark such messages as spam, quickest and easiest way to get rid of most of the spam messages (or, at least large number of them) is to reject hosts that are known to forge addresses and that do it repeatedly by using public DNSBL's. When speaking of Postfix, you do that by editing and modifying in such manner: 

I'm completely confused about question of necessity/benefit of stripping local network host names and IPs from from mail headers. Two years ago I've found an article which states that modern ESPs (Yahoo, Microsoft, Google...) considers like headers somehow related to spamyness of email, and gives email bad treatment consequently. From then, all my Postfix servers strips that info with directive. Recently I've come across KBs that states opposite - that, in short, every header MTA generates is useful and should not be removed forcibly. For now, I'm not experiencing issues, but these two schools cannot be right at the same time - do you know what practice is the best regarding this issue? 

Let's say I want to set limit of 200 messages per hour. Desired behavior is that 201 message holds until one hour period is over in order to be delivered. I would be really amazed if solution to this could respect my previously set per-domain rate limits: 

you will find that you got ~1.9 from URIBL_ABUSE_SURBL, 1.7 from URIBL_BLACK and 2.5 from URIBL_DBL_SPAM (...). That means: spamassassin found URIs in your message that is reported to be abusive or malicious. Different tests filled up your spam sore. You should carefully examine content of your logwatch messages in order to find out what it may be. That would be the 1st thing I recommend, for many reasons. regarding 

My question is - what to do to find script that is trying to abuse my Postfix server - is there a way for Postfix to tell me what is triggering command on local system? I cannot keep web server user () away from option to send emails forever. 

Just to add 2Â¢ more in this answer: file with code provided in question will certainly be marked as suspicious with Shell Detector. But, get ready for possibly many false positives. You'll have to eyeball-check and whitelist them. 

You have guessed it all. There is problem with this approach, basically there are no means for receiving party to distinguish whether you are legitimate sender or reckless domain-faking spammer. Even when you do not use niether SPF or DKIM/DMARC recieving party may at least know that email is coming from domain's A or MX record designated host. As this is, as far as I understand your question, not your case, your email massages would be treated bad from the start. Always try to protect your MTA reputation by sending only from domains that it may be associated with by DNS settings (A, MX, SPF, DKIM). Otherwise, your reputation shall not last for long. 

First, I'm not looking for software for detection of rootkits planted into server, as this may and may not work, especially on live system. I'm curious to find out what would be the signs of rootkit takeover of one server. At least what damage and externally - detectable behavior one could expect and witness while it is happening? My idea - maybe wrong - is that if you cannot detect compromise of system via tools like , , (which would, by definition, be tampered) you could, perhaps be assured that system is rooted by: 

Try with no, of course. (Also, check password scheme. Right now it may be plain text. Try to use any kind of password hashing instead.) 

First, it is a YARA rule, which means that ClamAV has found something it categorizes as malware. "UNOFFICIAL" part means just that ClamAV finding here is "unofficial" and that is the case when detection of malware is result of any non-built-in/default signature. Most probably you are using clamav-unofficial-sigs. What your log entry about is "The Joomla Unserialize Vulnerability" (CVE-2015-8562), a method of utilizing a malicious content in HTTP request. Basically, someone is trying to perform a well-known type of attack to your site. Be sure if you are using Joomla that it is up to date to stay protected. Last but not least, it seems like you have scanned apache's log file and it has found (as you can see attempt yo execute whatever is content of POST http request). Log file itself does not pose security treat in any way. 

not to check outbound email traffic at all - that highly depend on your Postfix configuration, to be more specific the way email is passed to binary use spamassassin whitelist options 

Generally speaking, 100gb of logs in indicates that was either not implemented or misconfigured or broken for some reason. Logs in are subject to policies defined in configuration of . I would first look whether it is installed (it should be by default on many distros) and how exactly configured in configuration file - most commonly . Second problem is generation of so many log data. If firewall / iptables-netfilter is suspected search for in output of . Take action accordingly. Your problem may be long time present but never escalated, speaking from my personal experience. 

Last night my server was compromised (I guess - one of outdated PHP CMS's) and many spam messages were sent. I have restricted access to Postfix ( directive in ) which resulted in successful damage control - now sending of spam is prevented and I get enteries like: 

Answer is no. I state this mostly because I'm aware that there are hard to imagine number of people with more experience in all aspects of being ESP admin than me and yet I run dozen of production email systems that qualifies as "small" without presented problems. From what you have posted it looks like you have taught of everything and, presumed you have properly implemented what is listed, there is only one option left - that your IP address has done bad things in it's past life. I mean (really) bad. Your IP address may be pulled from public blacklists at the ISP's initiative (which is vastly more efficient) but before that served virus and phishing traffic repeatedly for a prolonged period of time. If that is the case, unfortunately there is little that can be done, to my best knowledge. One option is to remain in attempt to maintain legitimate email server for a long time, paying the price of many emails being rejected before sender reputation - completely different thing to being present or not on public blacklists - is slowly established. Please keep us informed about your case. 

Apache has built-in default limit of 8190 for LimitRequestLine Directive, which regulates maximum length of HTTP GET request. As mentioned, see if altering this parameter does your job. Regarding apache going down every hour or more often: I would be surprised that this is related to rejecting too long GET request. Apache is carefully crafted to drop irregular requests with minimum effort, precisely in order to avoid denial of service and resource exhaustion. From what you posted, this sounds like it may be related to type of Multi-Processing Modules (MPMs) you are using, relation of minimum/maximum forked processes and available system resources and of course, processing power your successful request are using on the back-end (PHP). 

In order to use socket you need to specify: to also, you need to change settings in Postfix consequently: in add: 

You might be looking for nice command in Linux/UNIX. Basically, what it does is running a command with a modified scheduling priority. PHP might not help if running task is heavy by itself - without repeating.