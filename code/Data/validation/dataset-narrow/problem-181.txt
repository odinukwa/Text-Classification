I too recommend a Wireless survey. This avoids dead spots and other issues. With 2.4Ghz APs, you only have 3 clear channels that do not overlap. 5Ghz isn't so much of a problem. You might be able to get sufficient wireless coverage with 3 APs. Omni-directional antennas transmit like a bagel, Directly above and below aren't the best spot. Maybe two on the lower floor on the ceiling at each end and one on the second floor in the middle. Without a survey it'll be a guess, but we can apply some logic anyway. You can always lay it out and use the freebie Ekahau heat mapper to see what it looks like. I highly recommend isolating your voice traffic from your LAN traffic with a voice VLAN. The SG200 switches are voice aware. A voice aware switch should use QoS to prioritize voice traffic above your other traffic to avoid jitter and lost of frames. Voice traffic uses UDP protocol which isn't reliable (but it's fast). Traffic is dropped if network congestion happens. Some APs can do a Captive Portal mode where they either have a micro webserver or push the client to an external webserver (external from the AP). I advise you use something like this and have an Acceptable Use Policy that they must accept prior to accessing the internet. This limits your liability in the event they do something illegal. Regarding the 2800 AP, it's a thin AP and on Cisco's site you will find a bullet that reads "Cisco Mobility Express and controller based". Cisco Mobility Express can be purchased with some of the more expensive switches (such as a 3650). Look for something like the 300 series. They support Captive Portal as well. Your public network needs to be isolated from your internal traffic so people cannot access your business data. If you use VLAN, it must not have any route to your internal network. I recommend physical isolation so there is no chance of data leakage. Just pull a cable to a router network port (not a switched port but a VLAN or routed port). I also recommend using some kind of guest isolation so public wireless network users are not attempting to penetrate other public users devices. Your wireless LAN can be on the same subnet as your LAN or on a different one. If different, it needs to be routed by your router. If your internal wireless users are going to have full network access, I'd just flatten it out to make it simple. Your Router needs to be able to have virtual sub interfaces for VLAN or have multiple physical interfaces so you can send the guest traffic to the router directly. The Cisco RV215W has "Separate "virtual" networks to limit access to sensitive information" in it's description, so look at a router that has that kind of description. Whatever product you might choose, download and read the manuals to see if they will do what you need. Wireless routers are not really that great. I have a Cisco RV180W at home and I loose a lot. Enough that I want to move it, but that complicates things because I have an AP in the back of the house (for the yard...), a NAS, a wired Blu-ray. Next purchase will be an AP that will be in the living room coat closet...I have it wired already for PoE. Question - what is your phone system? Something hosted? Look at web managed switches and APs such as Meraki - They are pretty cool and if you attend a webinar, you can get a switch and an ap for free. However the cost model is a subscription. If you get a subscription model device, buy with the most years you can get up front as the prices increase over time. It's really a fairly simple network layout. You might need multiple connections to the router for each VLAN if it can't trunk like this: 

I agree with @artem_d93 that BGP is the most appropriate solution. With BGP, when one path fails, re-convergence occurs and a new path (over the alternate ISP) is presented to network traffic. This can take several minutes to occur. You really need to ask yourself or management how critical it is that these servers remain available if an ISP or a piece of network equipment fails. If it's not overkill and it's really necessary, one way to go might be to so something like I've done. I have two Cisco 4431 routers for each ISP, each connected directly to the other, sharing a standby (HSRP) address. These connect to a pair of DMZ switches that are port channeled together (not a stack as a stack could fail). Then have two ASA 5515X that are connected so they share state and failover. Then on to two Nexus 5548UP switches at my network core. This is a fully redundant setup so if there is a failure anywhere along the line, we will keep running. Our IPv4 and IPv6 blocks are used for addresses between the ASA 5515x and ISR4431 routers. I also have a dedicated WAN router (that has other one off connections) connected back to my core as well as to the 4431 routers Ask one of your ISPs to allocate you an IPv4 /24 block (the smallest possible). You will pay a monthly fee for this, but then it will be assigned for your needs as long as you stay with the ISP. You will need at least one business class router or routing firewall appliance that can handle BGP. Most of the dedicated routers can as well as some of the firewall appliances. Consumer grade equipment cannot. Once you have a block assigned, you will need to get an ASN from RIPE. This Autonomous System Number will allow you to be a unique node on the internet. Once you have redundant ISPs, you should have two routers that share an IP address (look up HSRP) in a standby/failover config, each router connected to one ISP. With HSRP, if one router fails, traffic will run over the other - the will share one of your assigned public addresses. Between the previously mentioned routers and your private network, you should have a (or a pair) of firewall devices. And perhaps a pair of DMZ switches. With all of this interconnected, you can have a fully redundant internet connection. Or you can have a pair of firewall devices that have all of this self contained. It can get pretty extensive, but if you really need it, it's really a solid way to go. Other options: 

In one of the articles i read the following regarding Bridge assurance: "When enabled, BDPUâ€™s are sent out all ports including the backup and alternate for each Hello Period. How this feature works is that it monitors the receipt of BPDUs on point to point links. If it does not hear a reply it changes the port state to an inconsistent state. This prevents any frames forwarding and a loop is avoided. The same is true of UDLD aggressive mode where a port err-disables." Q: When bridge assurance is enabled on a port, does that mean that it will start sending out BPDUs(irrespective of it's STP state)? If Bridge Assurance is enabled on a BLOCKED port, will the Blocked port also start sending BPDUs? If so, why? From what i know, the BPDUs are sent out ONLY from Designated ports once the STP is converged. Please correct me if i am wrong. 

Q1:As you see, my BGP neighborship is stuck in active state.From what i understand, R1 expects the neighborship packets from R2 with a source-ip of If you do on R2 for 11.11.11.11, you see that it is learnt via as . Therefore, the bgp neighborship packets sourced from R2 will use this egress source ip() Please confirm if my understanding is correct Q2:I add the following on R2. 

As you see, on R1, the route to 100.0.0.0 no longer exists. Moreover, the BGP vrf peering is in Active state. Why is this happening ? is there any relation between and ? Is it mandatory for to have neighbor activated for vrf routes to be exchanged? 

While reading up on front-door vrf concept here, i am just wondering , what if we made the network statements more precise/specific or used different subnets altogether, we would never have our tunnel go down due to Can you please confirm if this is a good approch to understanding concept? 

I want to ping from R2 to vrf lo0 of R1; but it fails, even though i have configured static route leaking. Please suggest why it fails 

I have to make sure that the loopback interface of R1(1.0.1.1/32) is learnt on R2 but with a few constraints. Step1: The loopback of R1 is learnt in global routing table of R2 via ospf Step2: R2 and R3 are ebgp neighbors for address-family ipv4 (on interface f0/2--which is in global routing table) and address-family ipv4 vrf (on interface f0/1 which is part of vrf TEST on both R2 and R3) Step3: At R2, I redistribute the ospf learnt routes to BGP (ipv4 address-family). Step4: R3 learns the bgp routes from R2 via ebgp (with a next hop of 192.16.2.9) in global routing table. Step5: At R3, I do a route-leaking from the bgp ipv4 address family to bgp vpnv4 vrf TEST address family for 1.0.1.1/32 So, R3 has a route to 1.0.1.1/32 in vrf TEST with a next hop of 192.16.2.9 (which is in global routing table) Step 6: R2 learns again the 1.0.1.1/32 route via ebgp address-family ipv4 vrf TEST with a next hop of 192.16.1.10 Now my objective is to make sure R2 can ping the 1.0.1.1/32 via the vrf TEST(but as expected it fails) Any suggestions on how to get the above scenario working. (One of the ways,this can be done is to configure the interface f0/2 on both R2 and R3 as below: 

There is a vPC domain, with vPC 20 for Sw2 and vPC 10 for Sw1. vPC peer link exists between NxOS1 and NxOS2. Suppose, Sw2 sends broadcast traffic.This broadcast traffic (after hashing) will choose any of the links while going upstream to NxOS1. Now the broadcast traffic is received on NXOS1. NxOS1 sends broadcast traffic to all ports except port20. Hence, NxOS1 will send the traffic egress via Port 10 and the Peer link. Now, the NxOS2 receives the traffic, it knows what was the status of port 10 and port 20 of NxOS1 (via CFS protocol). So, NxOS2 knows that SW1 might have received traffic from NxOS1 via Port 10 of NxOS1. NxOS2 also knows that (via CFS protocol) the broadcast traffic would have come to NxOS1(on port 20) from SW2. (I believe when the port channel is established, the system-mac of Sw2 is known to both NxOS1 and NxOS2). Hence, NxOS2 DOES NOT further send broadcast traffic(in egress direction downstream) on port 20 and port 10 of NxOS2. Q1:Please validate if my above understanding is correct. Q2:Here, CFSoE is playing a great role(for mac address synchronisation).What would happen if CFSoE stops working(assume peer link goes down)? Even then how would loop occur in above scenario? 

Also, if all you really wanted was a flat L2 topology, you have some configuration left over from someone that didn't: EX: 

You can see several IP addresses, vlans and such configured. To get back to the most basic of L2 functionality, we should remove some of that old unnecessary configuration (as long as you're sure that this is your network and you're not a rogue going against the wishes of your network admin.) EX: 

To answer this question, I'll go through your configuration piece by piece. Your SRX240 configuration is essentially correct and should work, with one small issue, that is your WAN/Internet interface (ge-0/0/0) appears to be using DHCP: SRX: 

The first thing I'd verify is that the phone is actually tagging frames with that VLAN ID, perhaps with a network tap or port mirror (which might not quite work right on this switch) If you manually had configured the phone to do that and you know it's working, this is probably a bug in the software. If not, manually set it on the phone or configure LLDP-MED (Link Level Discovery Protocol) on the interface to do this automatically. Depending on the type of phone (this includes most Polycom, Avaya, and Cisco), it should listen for LLDP packets and learn what the voice VLAN tag is and start sending on that tag. 

Clear the current configuration of each of the interfaces on the switch Create new blank/default configuration for each of the same interfaces Get rid of the probably unused IP address on vlan 100 Remove SNMP configuration (which is not relevant to your stated goal) Consolidate everything to the default VLAN (all of the interfaces are automatically members of "default" if another VLAN isn't specified.) Change the Management VLAN to the default VLAN, as it normally would be on a factory-fresh JunOS install Set the default gateway to be the Firewall, which is not strictly necessary in this topology since the EX is just acting as a layer 2 switch in this case, but at least you'll be able to ping hosts on the internet from the switch if everything is working. 

You'll probably want to do something similar for the EX2200-48 that you didn't give the configuration for, but hopefully you can look at the commands above and perform a similar procedure. If you flatten the topology as I've described, all of your clients will get their IP addresses from the SRX240 and will get internet access. 

On to the switches. You didn't tell us which port on the SRX240 is connected to which port on the EX2200, so this is hard to answer, but based on the configuration provided I can deduce that your WAN/Internet link is ge-0/0/0 on the SRX240, and that at least one switch is plugged into one of the other interfaces on the SRX (ge-0/0/1 through 15.) With the configuration you provided (for only the EX2200-24, and not the EX2200-48), your topology should work as long as port ge-0/0/0 through 21 are connected to the SRX. If, however the SRX is plugged into ports 22 or 23 on the the EX, you have a problem, because those ports are in trunk mode and the SRX isn't configured for or expecting VLAN-tagged ethernet frames. EX: 

Likely, your default gateway is provided by DHCP, so you probably don't need/want to define it statically. If 10.129.152.129 is not in your dhcp address/netmask though, JunOS is probably ignoring it, and since you also said that you were able to successfully get Internet connectivity when directly plugged into the SRX, this is probably not causing a problem. To get rid of this for cleanliness, issue the following commands on the SRX240: SRX: 

Such a setup isn't horribly uncommon, you'll even see a fair number of 'SMB' or branch firewall devices (such as the Juniper SRX series) with modular WAN/T1 card slots or even built-in DSL modems which can help to eliminate the need for another box, in other cases, the firewall functionality built into a modern Cisco ISR router is plenty sufficient for many basic firewall use cases (NAT, etc.) If the vendor data sheets even bother to mention it, most non-consumer-grade firewalls support being deployed in what will sometimes be referred to as an 'in-line deployment' both as a transparent bridge or a router between subnets. Often in such cases, NAT is treated like any other firewall rule or policy and is simply a configurable action (just like allow, deny, etc.) that occurs (or doesn't occur) whenever a new state is established to a specified matching source, destination, protocol, zone, or combination thereof. Depending on your fiber handoff device though, if it's managed customer premise equipment (CPE) leased/loaned to you by the provider, you might want to discuss it with them prior to removing / replacing it, and it's possible that the handoff device is doing anything from QinQ tagging to MPLS VPN that will exceed both the capabilities of your firewall and the provider's patience with you at the same time.